let Z=class Ft extends Error{constructor(t,n,r){super(typeof n=="object"?n.message:n||t,{cause:typeof n=="object"?n.cause:r}),this.type=t,Object.setPrototypeOf(this,Ft.prototype)}};function Xn(e){return e.replace(/_[a-z]/g,t=>t[1].toUpperCase())}const Qn="ERR_INVALID_VALUE",er="ERR_UNEXPECTED_VALUE",tr="ERR_UNEXPECTED_TYPE",Jt="ERR_PARSE";function nr(e,t){const n={};for(const r in e){const o=e[r];if(!o)continue;let s,i;typeof o=="function"?(s=r,i=o):[s,i]=o;try{const a=i(t(s));a!==void 0&&(n[r]=a)}catch(a){throw new Z(Jt,`Parser for "${r}" property failed${s===r?"":`. Source field: "${s}"`}`,a)}}return n}function zt(e){let t=e;if(typeof t=="string")try{t=JSON.parse(t)}catch(n){throw new Z(Qn,{cause:n})}if(typeof t!="object"||!t||Array.isArray(t))throw new Z(er);return t}function ae(e,t){return n=>{const r=o=>{if(!(n&&o===void 0))try{return t(o)}catch(s){throw new Z(Jt,{message:`"${e}" transformer failed to parse the value`,cause:s})}};return Object.assign(r,{isValid(o){try{return r(o),!0}catch{return!1}}})}}function rr(e,t){return ae("object",n=>{const r=zt(n);return nr(e,o=>r[o])})}function Yt(e){throw new Z(tr,`Unexpected value received: ${JSON.stringify(e)}`)}const et=ae("string",e=>{if(typeof e=="string"||typeof e=="number")return e.toString();Yt(e)});function X(e){return/^#[\da-f]{6}$/i.test(e)}function or(e){return/^#[\da-f]{3}$/i.test(e)}function Kt(e){const t=e.replace(/\s/g,"").toLowerCase();if(X(t))return t;if(or(t)){let r="#";for(let o=0;o<3;o+=1)r+=t[1+o].repeat(2);return r}const n=t.match(/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/)||t.match(/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),\d{1,3}\)$/);if(!n)throw new Error(`Value "${e}" does not satisfy any of known RGB formats.`);return n.slice(1).reduce((r,o)=>{const s=parseInt(o,10).toString(16);return r+(s.length===1?"0":"")+s},"#")}const sr=ae("rgb",e=>Kt(et()(e))),ir=ae("themeParams",e=>{const t=sr(!0);return Object.entries(zt(e)).reduce((n,[r,o])=>(n[Xn(r)]=t(o),n),{})});function ar(e,t){return ae("array",n=>{let r;if(Array.isArray(n))r=n;else if(typeof n=="string")try{const o=JSON.parse(n);Array.isArray(o)&&(r=o)}catch{}return r||Yt(n),r.map(e)})}let Q=class Zt extends Error{constructor(t,n,r){super(typeof n=="object"?n.message:n||t,{cause:typeof n=="object"?n.cause:r}),this.type=t,Object.setPrototypeOf(this,Zt.prototype)}};function Xt(e){return e.replace(/[A-Z]/g,t=>`_${t.toLowerCase()}`)}function cr(e){return e.replace(/_[a-z]/g,t=>t[1].toUpperCase())}const ur="ERR_INVALID_VALUE",pr="ERR_UNEXPECTED_VALUE",lr="ERR_UNEXPECTED_TYPE",Qt="ERR_PARSE";function en(e,t){const n={};for(const r in e){const o=e[r];if(!o)continue;let s,i;typeof o=="function"?(s=r,i=o):[s,i]=o;try{const a=i(t(s));a!==void 0&&(n[r]=a)}catch(a){throw new Q(Qt,`Parser for "${r}" property failed${s===r?"":`. Source field: "${s}"`}`,a)}}return n}function tn(e){let t=e;if(typeof t=="string")try{t=JSON.parse(t)}catch(n){throw new Q(ur,{cause:n})}if(typeof t!="object"||!t||Array.isArray(t))throw new Q(pr);return t}function P(e,t){return n=>{const r=o=>{if(!(n&&o===void 0))try{return t(o)}catch(s){throw new Q(Qt,{message:`"${e}" transformer failed to parse the value`,cause:s})}};return Object.assign(r,{isValid(o){try{return r(o),!0}catch{return!1}}})}}function x(e,t){return P(t||"object",n=>{const r=tn(n);return en(e,o=>r[o])})}function ce(e){throw new Q(lr,`Unexpected value received: ${JSON.stringify(e)}`)}const me=P("boolean",e=>{if(typeof e=="boolean")return e;const t=String(e);if(t==="1"||t==="true")return!0;if(t==="0"||t==="false")return!1;ce(e)}),A=P("string",e=>{if(typeof e=="string"||typeof e=="number")return e.toString();ce(e)}),ee=P("number",e=>{if(typeof e=="number")return e;if(typeof e=="string"){const t=Number(e);if(!Number.isNaN(t))return t}ce(e)}),fr=P("date",e=>e instanceof Date?e:new Date(ee()(e)*1e3));function nn(e,t){return P(t||"searchParams",n=>{typeof n!="string"&&!(n instanceof URLSearchParams)&&ce(n);const r=typeof n=="string"?new URLSearchParams(n):n;return en(e,o=>{const s=r.get(o);return s===null?void 0:s})})}function Le(e){for(const t in e)e[t]=[Xt(t),e[t]];return e}const _r=e=>{const t=ee(),n=ee(!0),r=A(),o=A(!0),s=me(!0),i=x(Le({addedToAttachmentMenu:s,allowsWriteToPm:s,firstName:r,id:t,isBot:s,isPremium:s,languageCode:o,lastName:o,photoUrl:o,username:o}),"User")(!0);return nn(Le({authDate:fr(),canSendAfter:n,chat:x(Le({id:t,type:r,title:r,photoUrl:o,username:o}),"Chat")(!0),chatInstance:o,chatType:o,hash:r,queryId:o,receiver:i,startParam:o,user:i}),"initData")(e)};function dr(e){return/^#[\da-f]{6}$/i.test(e)}function hr(e){return/^#[\da-f]{3}$/i.test(e)}function br(e){const t=e.replace(/\s/g,"").toLowerCase();if(dr(t))return t;if(hr(t)){let r="#";for(let o=0;o<3;o+=1)r+=t[1+o].repeat(2);return r}const n=t.match(/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/)||t.match(/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),\d{1,3}\)$/);if(!n)throw new Error(`Value "${e}" does not satisfy any of known RGB formats.`);return n.slice(1).reduce((r,o)=>{const s=parseInt(o,10).toString(16);return r+(s.length===1?"0":"")+s},"#")}const mr=P("rgb",e=>br(A()(e))),wr=P("themeParams",e=>{const t=mr(!0);return Object.entries(tn(e)).reduce((n,[r,o])=>(n[cr(r)]=t(o),n),{})});function gr(e){return JSON.stringify(Object.fromEntries(Object.entries(e).map(([t,n])=>[Xt(t),n])))}const yr=e=>{const t=A(),n=A(!0),r=me(!0);return nn({botInline:["tgWebAppBotInline",r],initData:["tgWebAppData",_r(!0)],initDataRaw:["tgWebAppData",n],platform:["tgWebAppPlatform",t],showSettings:["tgWebAppShowSettings",r],startParam:["tgWebAppStartParam",n],themeParams:["tgWebAppThemeParams",wr()],version:["tgWebAppVersion",t]},"launchParams")(e)};function vr(e){const{initDataRaw:t,startParam:n,showSettings:r,botInline:o}=e,s=new URLSearchParams;return s.set("tgWebAppPlatform",e.platform),s.set("tgWebAppThemeParams",gr(e.themeParams)),s.set("tgWebAppVersion",e.version),t&&s.set("tgWebAppData",t),n&&s.set("tgWebAppStartParam",n),typeof r=="boolean"&&s.set("tgWebAppShowSettings",r?"1":"0"),typeof o=="boolean"&&s.set("tgWebAppBotInline",o?"1":"0"),s.toString()}const Er=x({eventType:A(),eventData:e=>e},"miniAppsMessage"),rn=P("fn",e=>{if(typeof e=="function")return e;ce(e)});function Sr(e){return!!e&&typeof e=="object"&&!Array.isArray(e)}const Ar=x({TelegramWebviewProxy:x({postEvent:rn()})()});function on(e){return Ar().isValid(e)}function Cr(){try{return window.self!==window.top}catch{return!0}}var Rr=Object.defineProperty,kr=(e,t,n)=>t in e?Rr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,sn=(e,t,n)=>kr(e,typeof t!="symbol"?t+"":t,n);let l=class an extends Error{constructor(t,n,r){super(typeof n=="object"?n.message:n||t,{cause:typeof n=="object"?n.cause:r}),this.type=t,Object.setPrototypeOf(this,an.prototype)}};function He(e,t,n){return e.addEventListener(t,n),()=>e.removeEventListener(t,n)}function q(...e){const t=e.flat(1);return[t.push.bind(t),()=>{t.forEach(n=>{n()})}]}const xr="ERR_ABORTED",Pr="ERR_CANCELED",$r="ERR_TIMED_OUT";function $t(e){return new l(xr,{cause:e})}function Ot(e,t){return e.reject=t.reject,e}class y extends Promise{constructor(t,n){let r,o;typeof t=="function"?(r=t,o=n):o=t;let s,i;super((a,p)=>{o||(o={});const{abortSignal:c}=o;if(c&&c.aborted)return p($t(c.reason));const[f,b]=q(),m=d=>(...L)=>(b(),d(...L)),O=new AbortController,{signal:v}=O;i=m(d=>{O.abort(d),p(d)}),s=m(a),c&&f(He(c,"abort",()=>{i($t(c.reason))}));const{timeout:h}=o;if(h){const d=setTimeout(()=>{i(new l($r,`Timeout reached: ${h}ms`))},h);f(()=>{clearTimeout(d)})}r&&r(s,i,v)}),sn(this,"reject"),this.reject=i}static withFn(t,n){return new y((r,o,s)=>{try{const i=t(s);return i instanceof Promise?i.then(r,o):r(i)}catch(i){o(i)}},n)}static resolve(t){return new y(n=>{n(t)})}static reject(t){return new y((n,r)=>{r(t)})}cancel(){this.reject(new l(Pr))}catch(t){return this.then(void 0,t)}finally(t){return Ot(super.finally(t),this)}then(t,n){return Ot(super.then(t,n),this)}}function Tt(e,t){return e.resolve=t.resolve,e}class J extends y{constructor(t,n){let r,o;typeof t=="function"?(r=t,o=n):o=t;let s;super((i,a,p)=>{s=i,r&&r(i,a,p)},o),sn(this,"resolve"),this.resolve=s}static withFn(t,n){return new J((r,o,s)=>y.withFn(t,{abortSignal:s}).then(r,o),n)}static resolve(t){return new J(n=>{n(t)})}static reject(t){return new J((n,r)=>{r(t)})}catch(t){return this.then(void 0,t)}finally(t){return Tt(super.finally(t),this)}then(t,n){return Tt(super.then(t,n),this)}}function cn(e){return`tapps/${e}`}function C(e,t){sessionStorage.setItem(cn(e),JSON.stringify(t))}function R(e){const t=sessionStorage.getItem(cn(e));try{return t?JSON.parse(t):void 0}catch{}}function tt(e){return e.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`)}function Or(e,t){t||(t={});const{textColor:n,bgColor:r,shouldLog:o=!0}=t;function s(i,...a){if(!o||typeof o=="function"&&!o())return;const p="font-weight:bold;padding:0 5px;border-radius:5px";console[i](`%c${Intl.DateTimeFormat("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3,timeZone:"UTC"}).format(new Date)}%c / %c${e}`,`${p};background-color: lightblue;color:black`,"",`${p};${n?`color:${n};`:""}${r?`background-color:${r}`:""}`,...a)}return[function(...i){s("log",...i)},function(...i){s("error",...i)}]}function nt(e,t){document.documentElement.style.setProperty(e,t)}function rt(e){document.documentElement.style.removeProperty(e)}function Tr(e,t){t()}function W(e,t){t||(t={});const n=t.equals||Object.is;let r=[],o=e;const s=c=>{if(!n(o,c)){const f=o;o=c,Tr(p,()=>{[...r].forEach(([b,m])=>{b(c,f),m&&a(b,!0)})})}};function i(c){const f=typeof c!="object"?{once:c}:c;return{once:f.once||!1,signal:f.signal||!1}}const a=(c,f)=>{const b=i(f),m=r.findIndex(([O,v])=>O===c&&v.once===b.once&&v.signal===b.signal);m>=0&&r.splice(m,1)},p=Object.assign(function(){return jr(p),o},{destroy(){r=[]},set:s,reset(){s(e)},sub(c,f){return r.push([c,i(f)]),()=>a(c,f)},unsub:a,unsubAll(){r=r.filter(c=>c[1].signal)}});return p}const De=[];function jr(e){De.length&&De[De.length-1].add(e)}const Lr=W(!1),[un,Dr]=Or("Bridge",{bgColor:"#9147ff",textColor:"white",shouldLog:Lr}),Nr={clipboard_text_received:x({req_id:A(),data:e=>e===null?e:A(!0)(e)},"clipboard_text_received"),custom_method_invoked:x({req_id:A(),result:e=>e,error:A(!0)},"custom_method_invoked"),popup_closed:P("popup_closed",e=>e?x({button_id:t=>t==null?void 0:A()(t)})()(e):{}),viewport_changed:x({height:ee(),width:e=>e==null?window.innerWidth:ee()(e),is_state_stable:me(),is_expanded:me()},"viewport_changed")};function Vr(e){const t=window,[,n]=q(He(t,"resize",()=>{e(["viewport_changed",{width:window.innerWidth,height:window.innerHeight,is_state_stable:!0,is_expanded:!0}])}),He(t,"message",r=>{if(r.source!==t.parent)return;let o;try{o=Er()(r.data)}catch{return}const{eventType:s,eventData:i}=o,a=Nr[s];try{const p=a?a()(i):i;un("Event received:",p?{eventType:s,eventData:p}:{eventType:s}),e([s,p])}catch(p){Dr([`An error occurred processing the "${s}" event from the Telegram application.`,"Please, file an issue here:","https://github.com/Telegram-Mini-Apps/telegram-apps/issues/new/choose"].join(`
`),o,p)}}));return n}const jt=W(),Lt=W();function Mr(){return Lt()||Lt.set(Vr(jt.set)),jt}const Ne=W({});function pn(e){let t=Ne()[e];return t||(t=W(void 0,{equals(){return!1}}),Mr().sub(n=>{n&&n[0]===e&&t.set(n[1])}),Ne.set({...Ne(),[e]:t})),t}function E(e,t,n){return pn(e).sub(t,n)}const Br="ERR_METHOD_UNSUPPORTED",Ur="ERR_RETRIEVE_LP_FAILED",Ir="ERR_METHOD_PARAMETER_UNSUPPORTED",ln="ERR_UNKNOWN_ENV",qr="ERR_INVOKE_CUSTOM_METHOD_RESPONSE",Wr=W("https://web.telegram.org");function ot(e,t){un("Posting event:",t?{eventType:e,eventData:t}:{eventType:e});const n=window;if(on(n)){n.TelegramWebviewProxy.postEvent(e,JSON.stringify(t));return}const r=JSON.stringify({eventType:e,eventData:t});if(Cr())return n.parent.postMessage(r,Wr());const{external:o}=n;if(x({notify:rn()})().isValid(o)){o.notify(r);return}throw new l(ln)}function st(e,t,n){n||(n={});const{capture:r}=n,[o,s]=q();return new y(i=>{(Array.isArray(t)?t:[t]).forEach(a=>{o(E(a,p=>{(!r||(Array.isArray(t)?r({event:a,payload:p}):r(p)))&&i(p)}))}),(n.postEvent||ot)(e,n.params)},n).finally(s)}function fn(e){return yr()(e)}function _n(e){return fn(e.replace(/^[^?#]*[?#]/,"").replace(/[?#]/g,"&"))}function Hr(){return _n(window.location.href)}function Gr(){const e=performance.getEntriesByType("navigation")[0];if(!e)throw new Error("Unable to get first navigation entry.");return _n(e.name)}const Fr="launchParams";function Jr(){return fn(R(Fr)||"")}function zr(e){C("launchParams",vr(e))}function dn(e){return e instanceof Error?e.message+(e.cause?`
  ${dn(e.cause)}`:""):JSON.stringify(e)}function ue(){const e=[];for(const t of[Hr,Gr,Jr])try{const n=t();return zr(n),n}catch(n){e.push(n)}throw new l(Ur,["Unable to retrieve launch parameters from any known source. Perhaps, you have opened your app outside Telegram?","📖 Refer to docs for more information:","https://docs.telegram-mini-apps.com/packages/telegram-apps-sdk/environment","Collected errors:",...e.map(t=>`— ${dn(t)}`)].join(`
`))}function Dt(e){try{return ue(),!0}catch{return!1}return y.withFn(async()=>{if(on(window))return!0;try{return await st("web_app_request_theme","theme_changed",{timeout:100}),!0}catch{return!1}},e)}function Yr(e,t){window.dispatchEvent(new MessageEvent("message",{data:JSON.stringify({eventType:e,eventData:t}),source:window.parent}))}function Kr(){[["TelegramGameProxy_receiveEvent"],["TelegramGameProxy","receiveEvent"],["Telegram","WebView","receiveEvent"]].forEach(e=>{let t=window;e.forEach((n,r,o)=>{if(r===o.length-1){t[n]=Yr;return}n in t||(t[n]={}),t=t[n]})})}function Zr(){["TelegramGameProxy_receiveEvent","TelegramGameProxy","Telegram"].forEach(e=>{delete window[e]})}function ge(e,t,n){pn(e).unsub(t,n)}function Xr(e){return({req_id:t})=>t===e}function Nt(e){return e.split(".").map(Number)}function Qr(e,t){const n=Nt(e),r=Nt(t),o=Math.max(n.length,r.length);for(let s=0;s<o;s+=1){const i=n[s]||0,a=r[s]||0;if(i!==a)return i>a?1:-1}return 0}function w(e,t){return Qr(e,t)<=0}function N(e,t,n){if(typeof n=="string"){if(e==="web_app_open_link"){if(t==="try_instant_view")return w("6.4",n);if(t==="try_browser")return w("7.6",n)}if(e==="web_app_set_header_color"&&t==="color")return w("6.9",n);if(e==="web_app_close"&&t==="return_back")return w("7.6",n);if(e==="web_app_setup_main_button"&&t==="has_shine_effect")return w("7.10",n)}switch(e){case"web_app_open_tg_link":case"web_app_open_invoice":case"web_app_setup_back_button":case"web_app_set_background_color":case"web_app_set_header_color":case"web_app_trigger_haptic_feedback":return w("6.1",t);case"web_app_open_popup":return w("6.2",t);case"web_app_close_scan_qr_popup":case"web_app_open_scan_qr_popup":case"web_app_read_text_from_clipboard":return w("6.4",t);case"web_app_switch_inline_query":return w("6.7",t);case"web_app_invoke_custom_method":case"web_app_request_write_access":case"web_app_request_phone":return w("6.9",t);case"web_app_setup_settings_button":return w("6.10",t);case"web_app_biometry_get_info":case"web_app_biometry_open_settings":case"web_app_biometry_request_access":case"web_app_biometry_request_auth":case"web_app_biometry_update_token":return w("7.2",t);case"web_app_setup_swipe_behavior":return w("7.7",t);case"web_app_share_to_story":return w("7.8",t);case"web_app_setup_secondary_button":case"web_app_set_bottom_bar_color":return w("7.10",t);default:return["iframe_ready","iframe_will_reload","web_app_close","web_app_data_send","web_app_expand","web_app_open_link","web_app_ready","web_app_request_theme","web_app_request_viewport","web_app_setup_main_button","web_app_setup_closing_behavior"].includes(e)}}function eo(e,t){t||(t="strict");const n=typeof t=="function"?t:r=>{const{method:o,version:s}=r;let i,a;if("param"in r?(i=`Parameter "${r.param}" of "${o}" method is unsupported in Mini Apps version ${s}`,a=Ir):(i=`Method "${o}" is unsupported in Mini Apps version ${s}`,a=Br),t==="strict")throw new l(a,i);return console.warn(i)};return(r,o)=>N(r,e)?Sr(o)&&r==="web_app_set_header_color"&&"color"in o&&!N(r,"color",e)?n({version:e,method:r,param:"color"}):ot(r,o):n({version:e,method:r})}function to(e,t,n,r){return st("web_app_invoke_custom_method","custom_method_invoked",{...r||{},params:{method:e,params:t,req_id:n},capture:Xr(n)}).then(({result:o,error:s})=>{if(s)throw new l(qr,s);return o})}function no(){return performance.getEntriesByType("navigation")[0]}function $(){const e=no();return!!e&&e.type==="reload"}let B;function ro(e,t){B&&B.set(e,t)||t()}function oo(e){if(B)return e();B=new Map;try{e()}finally{B.forEach(t=>t()),B=void 0}}function u(e,t){t||(t={});const n=t.equals||Object.is;let r=[],o=e;const s=c=>{if(!n(o,c)){const f=o;o=c,ro(p,()=>{[...r].forEach(([b,m])=>{b(c,f),m&&a(b,!0)})})}};function i(c){const f=typeof c!="object"?{once:c}:c;return{once:f.once||!1,signal:f.signal||!1}}const a=(c,f)=>{const b=i(f),m=r.findIndex(([O,v])=>O===c&&v.once===b.once&&v.signal===b.signal);m>=0&&r.splice(m,1)},p=Object.assign(function(){return so(p),o},{destroy(){r=[]},set:s,reset(){s(e)},sub(c,f){return r.push([c,i(f)]),()=>a(c,f)},unsub:a,unsubAll(){r=r.filter(c=>c[1].signal)}});return p}const z=[];function so(e){z.length&&z[z.length-1].add(e)}function g(e,t){let n=new Set,r;function o(){return r||(r=u(i(),t))}function s(){o().set(i())}function i(){n.forEach(c=>{c.unsub(s,{signal:!0})});const a=new Set;let p;z.push(a);try{p=e()}finally{z.pop()}return a.forEach(c=>{c.sub(s,{signal:!0})}),n=a,p}return Object.assign(function(){return o()()},{destroy(){o().destroy()},sub(...a){return o().sub(...a)},unsub(...a){o().unsub(...a)},unsubAll(...a){o().unsubAll(...a)}})}const io=u((()=>{let e=0;return()=>(e+=1).toString()})()),hn=u(ot),T=u("0.0");function ao(e){e||(e={});const{postEvent:t}=e,n=e.version||ue().version;T.set(n),hn.set(typeof t=="function"?t:eo(n))}function co(){return io()()}function ye(e,t,n){return to(e,t,co(),{...n||{},postEvent:_})}const V=(e,t,n)=>(n||(n={}),n.postEvent||(n.postEvent=_),st(e,t,n)),_=(e,t)=>hn()(e,t);function bn(e){return g(()=>N(e,T()))}const G="ERR_POPUP_INVALID_PARAMS",it="ERR_INVALID_URL",uo="ERR_INVALID_SLUG",mn="ERR_ALREADY_REQUESTING",at="ERR_ALREADY_OPENED",po="ERR_ALREADY_MOUNTING",lo="ERR_VARS_ALREADY_BOUND",fo="ERR_NOT_AVAILABLE",_o="ERR_NOT_INITIALIZED",Vt="ERR_NOT_SUPPORTED",ho="ERR_NOT_MOUNTED";function Mt(){return typeof window>"u"}function wn(e,t,{isSupported:n,isMounted:r,component:o,supports:s}={}){const i=`${o?`${o}.`:""}${e}()`;n=n?Array.isArray(n)||typeof n=="object"&&"any"in n?n:[n]:void 0;function a(h){if(s){const d=s[h];return N(d[0],d[1],T())}return!0}const p=()=>{if(!n)return;const h=`it is unsupported in Mini Apps version ${T()}`;function d(S){return typeof S=="string"?N(S,T())?void 0:h:S.fn()?void 0:S.error}if(Array.isArray(n)){for(const S of n){const Pt=d(S);if(Pt)return Pt}return}let L;for(const S of n.any)if(L=d(S),!L)return;return h},c=(...h)=>{if(s){for(const d in s)if(s[d][2](...h)&&!a(d))return`option ${d} is not supported in Mini Apps version ${T()}`}},f=g(()=>!p()),b=g(()=>T()!=="0.0"),m=g(()=>!r||r()),O=g(()=>Dt("simple")&&!Mt()&&b()&&f()&&m());let v;if(s){v={};for(const h in s)v[h]=g(()=>a(h))}return Object.assign((...h)=>{const d=`Unable to call the ${i} ${o?"method":"function"}:`;if(Mt()||!Dt("simple"))throw new l(ln,`${d} it can't be called outside Mini Apps`);if(!b())throw new l(_o,`${d} the SDK was not initialized. Use the SDK init() function`);const L=p();if(L)throw new l(Vt,`${d} ${L}`);const S=c(...h);if(S)throw new l(Vt,`${d} ${S}`);if(!m())throw new l(ho,`${d} the component is not mounted. Use the ${o}.mount() method`);return t(...h)},t,{isAvailable:O,ifAvailable(...h){return O()?t(...h):void 0}},n?{isSupported:f}:{},v?{supports:v}:{})}function ve(e,t){return t||(t={}),(n,r,o,s)=>wn(n,r,{...t,isSupported:o||t.isSupported,supports:s,component:e})}function H(e,t,n){return ve(e,{isSupported:n,isMounted:t})}function k(e,t){return ve(e,{isSupported:t})}const Ee="web_app_setup_back_button",gn="back_button_pressed",Se="backButton",Ge=u(!1),te=u(!1),bo=bn(Ee),yn=H(Se,te,Ee),ct=k(Se,Ee),mo=yn("hide",()=>{ut(!1)}),wo=ct("mount",()=>{te()||(ut($()&&R(Se)||!1),te.set(!0))});function ut(e){e!==Ge()&&(_(Ee,{is_visible:e}),C(Se,e),Ge.set(e))}const go=ct("onClick",e=>E(gn,e)),yo=ct("offClick",e=>{ge(gn,e)}),vo=yn("show",()=>{ut(!0)});function Eo(){te.set(!1)}const _e=Object.freeze(Object.defineProperty({__proto__:null,hide:mo,isMounted:te,isSupported:bo,isVisible:Ge,mount:wo,offClick:yo,onClick:go,show:vo,unmount:Eo},Symbol.toStringTag,{value:"Module"}));function vn(e,t,n,{isMounting:r,isMounted:o,mountError:s}){return i=>y.withFn(async a=>{if(o())return;if(r())throw new l(po,`The ${e} component is already mounting`);r.set(!0);let p;try{p=[!0,await t({abortSignal:a})]}catch(c){p=[!1,c]}oo(()=>{if(r.set(!1),o.set(!0),p[0])n(p[1]);else{const c=p[1];throw s.set(c),c}})},i)}const j=ve,En=u(),Ve=u(!1),Me=u(!1),Sn=u(!1),So=u(!1),Ao=u(void 0);function pt(e){return e.available?{available:!0,tokenSaved:e.token_saved,deviceId:e.device_id,accessRequested:e.access_requested,type:e.type,accessGranted:e.access_granted}:{available:!1}}const Bt="web_app_biometry_get_info",Co=wn("requestBiometry",e=>V(Bt,"biometry_info_received",e).then(pt),{isSupported:Bt}),lt="web_app_biometry_request_auth",Ro="web_app_biometry_request_access",ko="web_app_biometry_open_settings",xo="web_app_biometry_update_token",An="biometry_info_received",I="biometry",Po=j(I),$o=k(I,lt),ft=H(I,Sn,lt);function Cn(){throw new l(fo,"Biometry is not available")}ft("authenticate",e=>y.withFn(async t=>{if(Ve())throw new l(mn,"Authentication is already in progress");const n=En();(!n||!n.available)&&Cn(),Ve.set(!0);try{const r=await V(lt,"biometry_auth_requested",{abortSignal:t,params:{reason:((e||{}).reason||"").trim()}}),{token:o}=r;return typeof o=="string"&&Ae({...n,token:o}),r}finally{Ve.set(!1)}},e));$o("openSettings",()=>{_(ko)});ft("requestAccess",e=>y.withFn(async t=>{if(Me())throw new l(mn,"Access request is already in progress");Me.set(!0);try{const n=await V(Ro,An,{abortSignal:t,params:{reason:(e||{}).reason||""}}).then(pt);return n.available||Cn(),Ae(n),n.accessGranted}finally{Me.set(!1)}},e));Po("mount",vn(I,e=>$()&&R(I)||Co(e),e=>{E(An,Oo),Ae(e)},{isMounted:Sn,mountError:Ao,isMounting:So}));const Oo=e=>{Ae(pt(e))};function Ae(e){En.set(e),C(I,e)}ft("updateToken",e=>(e||(e={}),V(xo,"biometry_token_updated",{...e,params:{token:e.token||"",reason:e.reason}}).then(t=>t.status)));function Ce(e,t){return ve(e,{isMounted:t})}const Re="closingBehavior",Ut=u(!1),Fe=u(!1),Rn=Ce(Re,Fe),To=j(Re);Rn("disableConfirmation",()=>{_t(!1)});Rn("enableConfirmation",()=>{_t(!0)});To("mount",()=>{Fe()||(_t($()&&R(Re)||!1),Fe.set(!0))});function _t(e){e!==Ut()&&(_("web_app_setup_closing_behavior",{need_confirmation:e}),C(Re,e),Ut.set(e))}const jo="web_app_invoke_custom_method",ke=k("cloudStorage",jo);ke("deleteItem",(e,t)=>{const n=Array.isArray(e)?e:[e];return n.length?ye("deleteStorageValues",{keys:n},t).then():y.resolve()});function Lo(e,t){const n=Array.isArray(e)?e:[e];return n.length?ye("getStorageValues",{keys:n},t).then(r=>{const o=rr(Object.fromEntries(n.map(s=>[s,et()])))()(r);return Array.isArray(e)?o:o[e]}):y.resolve(typeof e=="string"?"":{})}ke("getItem",Lo);ke("getKeys",e=>ye("getStorageKeys",{},e).then(ar(et())()));ke("setItem",(e,t,n)=>ye("saveStorageValue",{key:e,value:t},n).then());const pe="web_app_trigger_haptic_feedback",dt=k("hapticFeedback",pe),Do=bn(pe),No=dt("impactOccurred",e=>{_(pe,{type:"impact",impact_style:e})}),kn=dt("notificationOccurred",e=>{_(pe,{type:"notification",notification_type:e})}),Vo=dt("selectionChanged",()=>{_(pe,{type:"selection_change"})}),It=Object.freeze(Object.defineProperty({__proto__:null,impactOccurred:No,isSupported:Do,notificationOccurred:kn,selectionChanged:Vo},Symbol.toStringTag,{value:"Module"})),xn="web_app_open_invoice",Mo=k("invoice",xn),Be=u(!1);async function Bo(e,t,n){if(Be())throw new l(at,"An invoice is already opened");let r;if(t==="url"){const{hostname:o,pathname:s}=new URL(e,window.location.href);if(o!=="t.me")throw new l(it,`Link has unexpected hostname: ${o}`);const i=s.match(/^\/(\$|invoice\/)([A-Za-z0-9\-_=]+)$/);if(!i)throw new l(uo,'Expected to receive a link with a pathname in format "/invoice/{slug}" or "/${slug}"');[,,r]=i}else r=e,n=t;return Be.set(!0),V(xn,"invoice_closed",{...n,params:{slug:r},capture:o=>r===o.slug}).then(o=>o.status).finally(()=>{Be.set(!1)})}Mo("open",Bo);function Uo(e){const t=Kt(e);return Math.sqrt([.299,.587,.114].reduce((n,r,o)=>{const s=parseInt(t.slice(1+o*2,1+(o+1)*2),16);return n+s*s*r},0))<120}const Je=u(!1),Ue=u(!1),U=u({});function le(e){return g(()=>U()[e])}const Pn=le("bgColor"),$n=le("buttonColor"),Io=le("buttonTextColor"),qo=le("bottomBarBgColor"),ze=le("secondaryBgColor");function M(e){return g(()=>ht()[e])}const Y=u({hasShineEffect:!1,isEnabled:!0,isLoaderVisible:!1,isVisible:!1,text:"Continue"}),ht=g(()=>{const e=Y();return{...e,backgroundColor:e.backgroundColor||$n()||"#2481cc",textColor:e.textColor||Io()||"#ffffff"}}),ne=u(!1),Wo=M("backgroundColor"),Ho=M("hasShineEffect"),Go=M("isEnabled"),Fo=M("isLoaderVisible"),Jo=M("isVisible"),zo=M("text"),Yo=M("textColor"),Ko="web_app_setup_main_button",On="main_button_pressed",xe="mainButton",bt=j(xe),Zo=Ce(xe,ne),Xo=bt("mount",()=>{if(!ne()){const e=$()&&R(xe);e&&Y.set(e),ne.set(!0)}}),Tn=bt("onClick",e=>E(On,e)),jn=bt("offClick",e=>{ge(On,e)}),de=Zo("setParams",e=>{Y.set({...Y(),...Object.fromEntries(Object.entries(e).filter(([,n])=>n!==void 0))}),C(xe,Y());const t=ht();t.text&&_(Ko,{color:t.backgroundColor,has_shine_effect:t.hasShineEffect,is_active:t.isEnabled,is_progress_visible:t.isLoaderVisible,is_visible:t.isVisible,text:t.text,text_color:t.textColor})});function Qo(){ne.set(!1)}const es=Object.freeze(Object.defineProperty({__proto__:null,backgroundColor:Wo,hasShineEffect:Ho,isEnabled:Go,isLoaderVisible:Fo,isMounted:ne,isVisible:Jo,mount:Xo,offClick:jn,onClick:Tn,setParams:de,state:ht,text:zo,textColor:Yo,unmount:Qo},Symbol.toStringTag,{value:"Module"}));function mt(){throw new l(lo,"CSS variables are already bound")}function ts(e){return ir()(e)}const Pe="themeParams",ns="theme_changed",rs=j(Pe),os=Ce(Pe,Je);os("bindCssVars",e=>{Ue()&&mt(),e||(e=r=>`--tg-theme-${tt(r)}`);function t(r){Object.entries(U()).forEach(([o,s])=>{s&&r(o,s)})}function n(){t((r,o)=>{nt(e(r),o)})}return n(),U.sub(n),Ue.set(!0),()=>{t(rt),U.unsub(n),Ue.set(!1)}});const ss=rs("mount",()=>{Je()||(E(ns,is),U.set($()&&R(Pe)||ue().themeParams),Je.set(!0))}),is=e=>{const t=ts(e.theme_params);U.set(t),C(Pe,t)};function Ln(e){return g(()=>{const t=e();return X(t)?t:t==="bg_color"?Pn():ze()})}const re=u("bg_color"),wt=Ln(re),oe=u("bottom_bar_bg_color"),gt=g(()=>{const e=oe();return X(e)?e:e==="bottom_bar_bg_color"?qo()||ze():e==="secondary_bg_color"?ze():Pn()}),se=u("bg_color"),Dn=Ln(se),ie=u(!1),he=u(!1),as=g(()=>{const e=wt();return e?Uo(e):!1}),Nn=g(()=>({backgroundColor:re(),bottomBarColor:oe(),headerColor:se()})),Ye="web_app_set_background_color",Ke="web_app_set_bottom_bar_color",be="web_app_set_header_color",fe="miniApp",yt={any:[Ye,Ke,be]},cs=g(()=>yt.any.some(e=>N(e,T()))),Vn=j(fe),us=k(fe,yt),$e=H(fe,ie,yt),ps=$e("bindCssVars",e=>{he()&&mt();const[t,n]=q();function r(o,s){function i(){nt(o,s()||null)}i(),t(s.sub(i),rt.bind(null,o))}return e||(e=o=>`--tg-${tt(o)}`),r(e("bgColor"),wt),r(e("bottomBarColor"),gt),r(e("headerColor"),Dn),t(()=>{he.set(!1)}),he.set(!0),n}),Mn=Vn("close",e=>{_("web_app_close",{return_back:e})}),ls=us("mount",()=>{if(!ie()){const e=$()&&R(fe);ss(),Bn.ifAvailable(e?e.backgroundColor:"bg_color"),Un.ifAvailable(e?e.bottomBarColor:"bottom_bar_bg_color"),In.ifAvailable(e?e.headerColor:"bg_color"),ie.set(!0)}}),fs=Vn("ready",()=>{_("web_app_ready")});function vt(){C(fe,Nn())}const Bn=$e("setBackgroundColor",e=>{e!==re()&&(_(Ye,{color:e}),re.set(e),vt())},Ye),Un=$e("setBottomBarColor",e=>{e!==oe()&&(_(Ke,{color:e}),oe.set(e),vt())},Ke),In=$e("setHeaderColor",e=>{e!==se()&&(_(be,X(e)?{color:e}:{color_key:e}),se.set(e),vt())},be,{rgb:[be,"color",X]});function _s(){ie.set(!1)}const ds=Object.freeze(Object.defineProperty({__proto__:null,backgroundColor:re,backgroundColorRGB:wt,bindCssVars:ps,bottomBarColor:oe,bottomBarColorRGB:gt,close:Mn,headerColor:se,headerColorRGB:Dn,isCssVarsBound:he,isDark:as,isMounted:ie,isSupported:cs,mount:ls,ready:fs,setBackgroundColor:Bn,setBottomBarColor:Un,setHeaderColor:In,state:Nn,unmount:_s},Symbol.toStringTag,{value:"Module"}));function hs(e){const t=e.message.trim(),n=(e.title||"").trim(),r=e.buttons||[];if(n.length>64)throw new l(G,`Invalid title: ${n}`);if(!t||t.length>256)throw new l(G,`Invalid message: ${t}`);if(r.length>3)throw new l(G,`Invalid buttons count: ${r.length}`);return{title:n,message:t,buttons:r.length?r.map((o,s)=>{const i=o.id||"";if(i.length>64)throw new l(G,`Button with index ${s} has invalid id: ${i}`);if(!o.type||o.type==="default"||o.type==="destructive"){const a=o.text.trim();if(!a||a.length>64)throw new l(G,`Button with index ${s} has invalid text: ${a}`);return{type:o.type,text:a,id:i}}return{type:o.type,id:i}}):[{type:"close",id:""}]}}const qn="web_app_open_popup",bs=k("popup",qn),Ie=u(!1);bs("open",async e=>{if(Ie())throw new l(at,"A popup is already opened");Ie.set(!0);try{const{button_id:t=null}=await V(qn,"popup_closed",{...e,params:hs(e)});return t}finally{Ie.set(!1)}});const ms="web_app_close_scan_qr_popup",Wn="web_app_open_scan_qr_popup",ws="scan_qr_popup_closed",gs="qr_text_received",Hn=k("qrScanner",Wn),qt=Hn("close",()=>{F.set(!1),_(ms)}),F=u(!1);function ys(e){return y.withFn(t=>{if(F())throw new l(at,"The QR Scanner is already opened");F.set(!0),e||(e={});const{onCaptured:n,text:r,capture:o}=e,[,s]=q(F.sub(()=>{i.resolve()}),E(ws,()=>{F.set(!1)}),E(gs,a=>{n?n(a.data):(!o||o(a.data))&&(i.resolve(a.data),qt())})),i=new J({abortSignal:t}).catch(qt).finally(s);return(e.postEvent||_)(Wn,{text:r}),i},e)}Hn("open",ys);const K=u({hasShineEffect:!1,isEnabled:!0,isLoaderVisible:!1,isVisible:!1,position:"left",text:"Cancel"}),vs=g(()=>{const e=K();return{...e,backgroundColor:e.backgroundColor||gt()||"#000000",textColor:e.textColor||$n()||"#2481cc"}}),Ze=u(!1),Et="web_app_setup_secondary_button",Gn="secondary_button_pressed",Oe="secondaryButton",St=k(Oe,Et),Es=H(Oe,Ze,Et);St("mount",()=>{if(!Ze()){const e=$()&&R(Oe);e&&K.set(e),Ze.set(!0)}});St("onClick",e=>E(Gn,e));St("offClick",e=>{ge(Gn,e)});Es("setParams",e=>{K.set({...K(),...Object.fromEntries(Object.entries(e).filter(([,n])=>n!==void 0))}),C(Oe,K());const t=vs();t.text&&_(Et,{color:t.backgroundColor,has_shine_effect:t.hasShineEffect,is_active:t.isEnabled,is_progress_visible:t.isLoaderVisible,is_visible:t.isVisible,position:t.position,text:t.text,text_color:t.textColor})});const At="web_app_setup_settings_button",Fn="settings_button_pressed",Te="settingsButton",Wt=u(!1),Xe=u(!1),Ct=k(Te,At),Jn=H(Te,Xe,At);Jn("hide",()=>{Rt(!1)});Ct("mount",()=>{Xe()||(Rt($()&&R(Te)||!1),Xe.set(!0))});function Rt(e){e!==Wt()&&(_(At,{is_visible:e}),C(Te,e),Wt.set(e))}Ct("onClick",e=>E(Fn,e));Ct("offClick",e=>{ge(Fn,e)});Jn("show",()=>{Rt(!0)});const kt="web_app_setup_swipe_behavior",je="swipeBehavior",Qe=u(!1),Ht=u(!0),Ss=k(je,kt),zn=H(je,Qe,kt);zn("disableVertical",()=>{xt(!1)});zn("enableVertical",()=>{xt(!0)});Ss("mount",()=>{Qe()||(xt($()&&R(je)||!1,!0),Qe.set(!0))});function xt(e,t){(e!==Ht()||t)&&(_(kt,{allow_vertical_swipe:e}),C(je,e),Ht.set(e))}const D=u({height:0,width:0,isExpanded:!1,stableHeight:0}),Yn=u(!1),qe=u(!1),As=u(!1),Cs=u(void 0);function Rs(e){return V("web_app_request_viewport","viewport_changed",e).then(t=>({height:t.height,width:t.width,isExpanded:t.is_expanded,isStable:t.is_state_stable}))}const we="viewport",Kn=j(we),ks=Ce(we,Yn);ks("bindCssVars",e=>{qe()&&mt(),e||(e=r=>`--tg-viewport-${tt(r)}`);const t=["height","width","stableHeight"];function n(){t.forEach(r=>{nt(e(r),`${D()[r]}px`)})}return n(),D.sub(n),qe.set(!0),()=>{t.forEach(rt),D.unsub(n),qe.set(!1)}});Kn("expand",()=>{_("web_app_expand")});Kn("mount",vn(we,e=>{const t=$()&&R(we);if(t)return t;if(["macos","tdesktop","unigram","webk","weba","web"].includes(ue().platform)){const n=window;return{isExpanded:!0,height:n.innerHeight,width:n.innerWidth,stableHeight:n.innerHeight}}return e.timeout||(e.timeout=1e3),Rs(e).then(n=>({height:n.height,isExpanded:n.isExpanded,stableHeight:n.isStable?n.height:D().stableHeight,width:n.width}))},e=>{E("viewport_changed",xs),Zn(e)},{isMounted:Yn,isMounting:As,mountError:Cs}));const xs=e=>{Zn({height:e.height,isExpanded:e.is_expanded,stableHeight:e.is_state_stable?e.height:D().stableHeight,width:e.width})};function Zn(e){D.set({isExpanded:e.isExpanded,height:We(e.height),width:We(e.width),stableHeight:We(e.stableHeight)}),C("viewport",D())}function We(e){return Math.max(e,0)}const Ps=j();Ps("openLink",(e,t)=>{if(typeof e=="string")try{e=new URL(e)}catch(n){throw new l(it,`"${e.toString()}" is invalid URL`,n)}t||(t={}),_("web_app_open_link",{url:e.toString(),try_browser:t.tryBrowser,try_instant_view:t.tryInstantView})});const Gt="web_app_open_tg_link",$s=j(),Os=$s("openTelegramLink",e=>{const t=e.toString();if(!t.match(/^https:\/\/t.me\/.+/))throw new l(it,`"${t}" is invalid URL`);if(!N(Gt,T())){window.location.href=t;return}e=new URL(e),_(Gt,{path_full:e.pathname+e.search})}),Ts=j();Ts("shareURL",(e,t)=>{Os("https://t.me/share/url?"+new URLSearchParams({url:e,text:t||""}).toString().replace(/\+/g,"%20"))});function js(e){ao(e),Kr();const[t,n]=q(E("reload_iframe",()=>{_("iframe_will_reload"),window.location.reload()}),Zr),{acceptCustomStyles:r=!0}={};if(r){const o=document.createElement("style");o.id="telegram-custom-styles",document.head.appendChild(o),t(E("set_custom_style",s=>{o.innerHTML=s}),()=>{document.head.removeChild(o)})}return _("iframe_ready",{reload_supported:!0}),n}class Ls{closeWith(t){kn(t),ds.close.isAvailable()&&Mn()}getInitData(){const{initData:t}=ue();if(t===void 0)throw"Could not retrieve Telegram Launch Parameters";return t}init(t){js(),_e.mount(),es.mount(),t==="/"?_e.hide():_e.show(),_e.onClick(()=>window.history.back())}setMainButtonText(t){de({text:t})}onMainButtonClick(t){Tn(t)}showMainButton(t){this.setMainButtonText(t),de({isVisible:!0})}offMainButtonClick(t){jn(t)}hideMainButton(){de({isVisible:!1})}envokeHaptic(t){It.impactOccurred.isAvailable()&&It.impactOccurred(t)}}const Ds=new Ls;export{Ds as p};
