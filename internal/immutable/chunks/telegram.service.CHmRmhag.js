let Q=class Yt extends Error{constructor(t,n,r){super(typeof n=="object"?n.message:n||t,{cause:typeof n=="object"?n.cause:r}),this.type=t,Object.setPrototypeOf(this,Yt.prototype)}};function or(e){return e.replace(/_[a-z]/g,t=>t[1].toUpperCase())}const sr="ERR_INVALID_VALUE",ir="ERR_UNEXPECTED_VALUE",ar="ERR_UNEXPECTED_TYPE",Zt="ERR_PARSE";function cr(e,t){const n={};for(const r in e){const o=e[r];if(!o)continue;let s,i;typeof o=="function"?(s=r,i=o):[s,i]=o;try{const a=i(t(s));a!==void 0&&(n[r]=a)}catch(a){throw new Q(Zt,`Parser for "${r}" property failed${s===r?"":`. Source field: "${s}"`}`,a)}}return n}function Xt(e){let t=e;if(typeof t=="string")try{t=JSON.parse(t)}catch(n){throw new Q(sr,{cause:n})}if(typeof t!="object"||!t||Array.isArray(t))throw new Q(ir);return t}function le(e,t){return n=>{const r=o=>{if(!(n&&o===void 0))try{return t(o)}catch(s){throw new Q(Zt,{message:`"${e}" transformer failed to parse the value`,cause:s})}};return Object.assign(r,{isValid(o){try{return r(o),!0}catch{return!1}}})}}function ur(e,t){return le("object",n=>{const r=Xt(n);return cr(e,o=>r[o])})}function Qt(e){throw new Q(ar,`Unexpected value received: ${JSON.stringify(e)}`)}const nt=le("string",e=>{if(typeof e=="string"||typeof e=="number")return e.toString();Qt(e)});function ee(e){return/^#[\da-f]{6}$/i.test(e)}function lr(e){return/^#[\da-f]{3}$/i.test(e)}function en(e){const t=e.replace(/\s/g,"").toLowerCase();if(ee(t))return t;if(lr(t)){let r="#";for(let o=0;o<3;o+=1)r+=t[1+o].repeat(2);return r}const n=t.match(/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/)||t.match(/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),\d{1,3}\)$/);if(!n)throw new Error(`Value "${e}" does not satisfy any of known RGB formats.`);return n.slice(1).reduce((r,o)=>{const s=parseInt(o,10).toString(16);return r+(s.length===1?"0":"")+s},"#")}const pr=le("rgb",e=>en(nt()(e))),fr=le("themeParams",e=>{const t=pr(!0);return Object.entries(Xt(e)).reduce((n,[r,o])=>(n[or(r)]=t(o),n),{})});function dr(e,t){return le("array",n=>{let r;if(Array.isArray(n))r=n;else if(typeof n=="string")try{const o=JSON.parse(n);Array.isArray(o)&&(r=o)}catch{}return r||Qt(n),r.map(e)})}let te=class tn extends Error{constructor(t,n,r){super(typeof n=="object"?n.message:n||t,{cause:typeof n=="object"?n.cause:r}),this.type=t,Object.setPrototypeOf(this,tn.prototype)}};function nn(e){return e.replace(/[A-Z]/g,t=>`_${t.toLowerCase()}`)}function _r(e){return e.replace(/_[a-z]/g,t=>t[1].toUpperCase())}const hr="ERR_INVALID_VALUE",br="ERR_UNEXPECTED_VALUE",gr="ERR_UNEXPECTED_TYPE",rn="ERR_PARSE";function on(e,t){const n={};for(const r in e){const o=e[r];if(!o)continue;let s,i;typeof o=="function"?(s=r,i=o):[s,i]=o;try{const a=i(t(s));a!==void 0&&(n[r]=a)}catch(a){throw new te(rn,`Parser for "${r}" property failed${s===r?"":`. Source field: "${s}"`}`,a)}}return n}function sn(e){let t=e;if(typeof t=="string")try{t=JSON.parse(t)}catch(n){throw new te(hr,{cause:n})}if(typeof t!="object"||!t||Array.isArray(t))throw new te(br);return t}function O(e,t){return n=>{const r=o=>{if(!(n&&o===void 0))try{return t(o)}catch(s){throw new te(rn,{message:`"${e}" transformer failed to parse the value`,cause:s})}};return Object.assign(r,{isValid(o){try{return r(o),!0}catch{return!1}}})}}function T(e,t){return O(t||"object",n=>{const r=sn(n);return on(e,o=>r[o])})}function pe(e){throw new te(gr,`Unexpected value received: ${JSON.stringify(e)}`)}const ve=O("boolean",e=>{if(typeof e=="boolean")return e;const t=String(e);if(t==="1"||t==="true")return!0;if(t==="0"||t==="false")return!1;pe(e)}),A=O("string",e=>{if(typeof e=="string"||typeof e=="number")return e.toString();pe(e)}),ne=O("number",e=>{if(typeof e=="number")return e;if(typeof e=="string"){const t=Number(e);if(!Number.isNaN(t))return t}pe(e)}),mr=O("date",e=>e instanceof Date?e:new Date(ne()(e)*1e3));function an(e,t){return O(t||"searchParams",n=>{typeof n!="string"&&!(n instanceof URLSearchParams)&&pe(n);const r=typeof n=="string"?new URLSearchParams(n):n;return on(e,o=>{const s=r.get(o);return s===null?void 0:s})})}function De(e){for(const t in e)e[t]=[nn(t),e[t]];return e}const wr=e=>{const t=ne(),n=ne(!0),r=A(),o=A(!0),s=ve(!0),i=T(De({addedToAttachmentMenu:s,allowsWriteToPm:s,firstName:r,id:t,isBot:s,isPremium:s,languageCode:o,lastName:o,photoUrl:o,username:o}),"User")(!0);return an(De({authDate:mr(),canSendAfter:n,chat:T(De({id:t,type:r,title:r,photoUrl:o,username:o}),"Chat")(!0),chatInstance:o,chatType:o,hash:r,queryId:o,receiver:i,startParam:o,user:i}),"initData")(e)};function yr(e){return/^#[\da-f]{6}$/i.test(e)}function vr(e){return/^#[\da-f]{3}$/i.test(e)}function Er(e){const t=e.replace(/\s/g,"").toLowerCase();if(yr(t))return t;if(vr(t)){let r="#";for(let o=0;o<3;o+=1)r+=t[1+o].repeat(2);return r}const n=t.match(/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/)||t.match(/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),\d{1,3}\)$/);if(!n)throw new Error(`Value "${e}" does not satisfy any of known RGB formats.`);return n.slice(1).reduce((r,o)=>{const s=parseInt(o,10).toString(16);return r+(s.length===1?"0":"")+s},"#")}const Cr=O("rgb",e=>Er(A()(e))),Sr=O("themeParams",e=>{const t=Cr(!0);return Object.entries(sn(e)).reduce((n,[r,o])=>(n[_r(r)]=t(o),n),{})});function Ar(e){return JSON.stringify(Object.fromEntries(Object.entries(e).map(([t,n])=>[nn(t),n])))}const kr=e=>{const t=A(),n=A(!0),r=ve(!0);return an({botInline:["tgWebAppBotInline",r],initData:["tgWebAppData",wr(!0)],initDataRaw:["tgWebAppData",n],platform:["tgWebAppPlatform",t],showSettings:["tgWebAppShowSettings",r],startParam:["tgWebAppStartParam",n],themeParams:["tgWebAppThemeParams",Sr()],version:["tgWebAppVersion",t]},"launchParams")(e)};function Rr(e){const{initDataRaw:t,startParam:n,showSettings:r,botInline:o}=e,s=new URLSearchParams;return s.set("tgWebAppPlatform",e.platform),s.set("tgWebAppThemeParams",Ar(e.themeParams)),s.set("tgWebAppVersion",e.version),t&&s.set("tgWebAppData",t),n&&s.set("tgWebAppStartParam",n),typeof r=="boolean"&&s.set("tgWebAppShowSettings",r?"1":"0"),typeof o=="boolean"&&s.set("tgWebAppBotInline",o?"1":"0"),s.toString()}const xr=T({eventType:A(),eventData:e=>e},"miniAppsMessage"),cn=O("fn",e=>{if(typeof e=="function")return e;pe(e)});function Tr(e){return!!e&&typeof e=="object"&&!Array.isArray(e)}const Or=T({TelegramWebviewProxy:T({postEvent:cn()})()});function un(e){return Or().isValid(e)}function Pr(){try{return window.self!==window.top}catch{return!0}}var $r=Object.defineProperty,Vr=(e,t,n)=>t in e?$r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ln=(e,t,n)=>Vr(e,typeof t!="symbol"?t+"":t,n);let p=class pn extends Error{constructor(t,n,r){super(typeof n=="object"?n.message:n||t,{cause:typeof n=="object"?n.cause:r}),this.type=t,Object.setPrototypeOf(this,pn.prototype)}};function ze(e,t,n){return e.addEventListener(t,n),()=>e.removeEventListener(t,n)}function H(...e){const t=e.flat(1);return[t.push.bind(t),()=>{t.forEach(n=>{n()})}]}const Ir="ERR_ABORTED",jr="ERR_CANCELED",Br="ERR_TIMED_OUT";function jt(e){return new p(Ir,{cause:e})}function Bt(e,t){return e.reject=t.reject,e}class v extends Promise{constructor(t,n){let r,o;typeof t=="function"?(r=t,o=n):o=t;let s,i;super((a,l)=>{o||(o={});const{abortSignal:c}=o;if(c&&c.aborted)return l(jt(c.reason));const[f,b]=H(),m=_=>(...B)=>(b(),_(...B)),$=new AbortController,{signal:E}=$;i=m(_=>{$.abort(_),l(_)}),s=m(a),c&&f(ze(c,"abort",()=>{i(jt(c.reason))}));const{timeout:h}=o;if(h){const _=setTimeout(()=>{i(new p(Br,`Timeout reached: ${h}ms`))},h);f(()=>{clearTimeout(_)})}r&&r(s,i,E)}),ln(this,"reject"),this.reject=i}static withFn(t,n){return new v((r,o,s)=>{try{const i=t(s);return i instanceof Promise?i.then(r,o):r(i)}catch(i){o(i)}},n)}static resolve(t){return new v(n=>{n(t)})}static reject(t){return new v((n,r)=>{r(t)})}cancel(){this.reject(new p(jr))}catch(t){return this.then(void 0,t)}finally(t){return Bt(super.finally(t),this)}then(t,n){return Bt(super.then(t,n),this)}}function Nt(e,t){return e.resolve=t.resolve,e}class K extends v{constructor(t,n){let r,o;typeof t=="function"?(r=t,o=n):o=t;let s;super((i,a,l)=>{s=i,r&&r(i,a,l)},o),ln(this,"resolve"),this.resolve=s}static withFn(t,n){return new K((r,o,s)=>v.withFn(t,{abortSignal:s}).then(r,o),n)}static resolve(t){return new K(n=>{n(t)})}static reject(t){return new K((n,r)=>{r(t)})}catch(t){return this.then(void 0,t)}finally(t){return Nt(super.finally(t),this)}then(t,n){return Nt(super.then(t,n),this)}}function fn(e){return`tapps/${e}`}function k(e,t){sessionStorage.setItem(fn(e),JSON.stringify(t))}function R(e){const t=sessionStorage.getItem(fn(e));try{return t?JSON.parse(t):void 0}catch{}}function rt(e){return e.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`)}function Nr(e,t){t||(t={});const{textColor:n,bgColor:r,shouldLog:o=!0}=t;function s(i,...a){if(!o||typeof o=="function"&&!o())return;const l="font-weight:bold;padding:0 5px;border-radius:5px";console[i](`%c${Intl.DateTimeFormat("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3,timeZone:"UTC"}).format(new Date)}%c / %c${e}`,`${l};background-color: lightblue;color:black`,"",`${l};${n?`color:${n};`:""}${r?`background-color:${r}`:""}`,...a)}return[function(...i){s("log",...i)},function(...i){s("error",...i)}]}function ot(e,t){document.documentElement.style.setProperty(e,t)}function st(e){document.documentElement.style.removeProperty(e)}function Dr(e,t){t()}function J(e,t){t||(t={});const n=t.equals||Object.is;let r=[],o=e;const s=c=>{if(!n(o,c)){const f=o;o=c,Dr(l,()=>{[...r].forEach(([b,m])=>{b(c,f),m&&a(b,!0)})})}};function i(c){const f=typeof c!="object"?{once:c}:c;return{once:f.once||!1,signal:f.signal||!1}}const a=(c,f)=>{const b=i(f),m=r.findIndex(([$,E])=>$===c&&E.once===b.once&&E.signal===b.signal);m>=0&&r.splice(m,1)},l=Object.assign(function(){return Lr(l),o},{destroy(){r=[]},set:s,reset(){s(e)},sub(c,f){return r.push([c,i(f)]),()=>a(c,f)},unsub:a,unsubAll(){r=r.filter(c=>c[1].signal)}});return l}const Le=[];function Lr(e){Le.length&&Le[Le.length-1].add(e)}const Mr=J(!1),[dn,Ur]=Nr("Bridge",{bgColor:"#9147ff",textColor:"white",shouldLog:Mr}),qr={clipboard_text_received:T({req_id:A(),data:e=>e===null?e:A(!0)(e)},"clipboard_text_received"),custom_method_invoked:T({req_id:A(),result:e=>e,error:A(!0)},"custom_method_invoked"),popup_closed:O("popup_closed",e=>e?T({button_id:t=>t==null?void 0:A()(t)})()(e):{}),viewport_changed:T({height:ne(),width:e=>e==null?window.innerWidth:ne()(e),is_state_stable:ve(),is_expanded:ve()},"viewport_changed")};function Wr(e){const t=window,[,n]=H(ze(t,"resize",()=>{e(["viewport_changed",{width:window.innerWidth,height:window.innerHeight,is_state_stable:!0,is_expanded:!0}])}),ze(t,"message",r=>{if(r.source!==t.parent)return;let o;try{o=xr()(r.data)}catch{return}const{eventType:s,eventData:i}=o,a=qr[s];try{const l=a?a()(i):i;dn("Event received:",l?{eventType:s,eventData:l}:{eventType:s}),e([s,l])}catch(l){Ur([`An error occurred processing the "${s}" event from the Telegram application.`,"Please, file an issue here:","https://github.com/Telegram-Mini-Apps/telegram-apps/issues/new/choose"].join(`
`),o,l)}}));return n}const Dt=J(),Lt=J();function Hr(){return Lt()||Lt.set(Wr(Dt.set)),Dt}const Me=J({});function _n(e){let t=Me()[e];return t||(t=J(void 0,{equals(){return!1}}),Hr().sub(n=>{n&&n[0]===e&&t.set(n[1])}),Me.set({...Me(),[e]:t})),t}function C(e,t,n){return _n(e).sub(t,n)}const Jr="ERR_METHOD_UNSUPPORTED",Fr="ERR_RETRIEVE_LP_FAILED",Gr="ERR_METHOD_PARAMETER_UNSUPPORTED",hn="ERR_UNKNOWN_ENV",zr="ERR_INVOKE_CUSTOM_METHOD_RESPONSE",Kr=J("https://web.telegram.org");function it(e,t){dn("Posting event:",t?{eventType:e,eventData:t}:{eventType:e});const n=window;if(un(n)){n.TelegramWebviewProxy.postEvent(e,JSON.stringify(t));return}const r=JSON.stringify({eventType:e,eventData:t});if(Pr())return n.parent.postMessage(r,Kr());const{external:o}=n;if(T({notify:cn()})().isValid(o)){o.notify(r);return}throw new p(hn)}function at(e,t,n){n||(n={});const{capture:r}=n,[o,s]=H();return new v(i=>{(Array.isArray(t)?t:[t]).forEach(a=>{o(C(a,l=>{(!r||(Array.isArray(t)?r({event:a,payload:l}):r(l)))&&i(l)}))}),(n.postEvent||it)(e,n.params)},n).finally(s)}function bn(e){return kr()(e)}function gn(e){return bn(e.replace(/^[^?#]*[?#]/,"").replace(/[?#]/g,"&"))}function Yr(){return gn(window.location.href)}function Zr(){const e=performance.getEntriesByType("navigation")[0];if(!e)throw new Error("Unable to get first navigation entry.");return gn(e.name)}const Xr="launchParams";function Qr(){return bn(R(Xr)||"")}function eo(e){k("launchParams",Rr(e))}function mn(e){return e instanceof Error?e.message+(e.cause?`
  ${mn(e.cause)}`:""):JSON.stringify(e)}function fe(){const e=[];for(const t of[Yr,Zr,Qr])try{const n=t();return eo(n),n}catch(n){e.push(n)}throw new p(Fr,["Unable to retrieve launch parameters from any known source. Perhaps, you have opened your app outside Telegram?","ðŸ“– Refer to docs for more information:","https://docs.telegram-mini-apps.com/packages/telegram-apps-sdk/environment","Collected errors:",...e.map(t=>`â€” ${mn(t)}`)].join(`
`))}function Mt(e){try{return fe(),!0}catch{return!1}return v.withFn(async()=>{if(un(window))return!0;try{return await at("web_app_request_theme","theme_changed",{timeout:100}),!0}catch{return!1}},e)}function to(e,t){window.dispatchEvent(new MessageEvent("message",{data:JSON.stringify({eventType:e,eventData:t}),source:window.parent}))}function no(){[["TelegramGameProxy_receiveEvent"],["TelegramGameProxy","receiveEvent"],["Telegram","WebView","receiveEvent"]].forEach(e=>{let t=window;e.forEach((n,r,o)=>{if(r===o.length-1){t[n]=to;return}n in t||(t[n]={}),t=t[n]})})}function ro(){["TelegramGameProxy_receiveEvent","TelegramGameProxy","Telegram"].forEach(e=>{delete window[e]})}function de(e,t,n){_n(e).unsub(t,n)}function oo(e){return({req_id:t})=>t===e}function Ut(e){return e.split(".").map(Number)}function so(e,t){const n=Ut(e),r=Ut(t),o=Math.max(n.length,r.length);for(let s=0;s<o;s+=1){const i=n[s]||0,a=r[s]||0;if(i!==a)return i>a?1:-1}return 0}function w(e,t){return so(e,t)<=0}function D(e,t,n){if(typeof n=="string"){if(e==="web_app_open_link"){if(t==="try_instant_view")return w("6.4",n);if(t==="try_browser")return w("7.6",n)}if(e==="web_app_set_header_color"&&t==="color")return w("6.9",n);if(e==="web_app_close"&&t==="return_back")return w("7.6",n);if(e==="web_app_setup_main_button"&&t==="has_shine_effect")return w("7.10",n)}switch(e){case"web_app_open_tg_link":case"web_app_open_invoice":case"web_app_setup_back_button":case"web_app_set_background_color":case"web_app_set_header_color":case"web_app_trigger_haptic_feedback":return w("6.1",t);case"web_app_open_popup":return w("6.2",t);case"web_app_close_scan_qr_popup":case"web_app_open_scan_qr_popup":case"web_app_read_text_from_clipboard":return w("6.4",t);case"web_app_switch_inline_query":return w("6.7",t);case"web_app_invoke_custom_method":case"web_app_request_write_access":case"web_app_request_phone":return w("6.9",t);case"web_app_setup_settings_button":return w("6.10",t);case"web_app_biometry_get_info":case"web_app_biometry_open_settings":case"web_app_biometry_request_access":case"web_app_biometry_request_auth":case"web_app_biometry_update_token":return w("7.2",t);case"web_app_setup_swipe_behavior":return w("7.7",t);case"web_app_share_to_story":return w("7.8",t);case"web_app_setup_secondary_button":case"web_app_set_bottom_bar_color":return w("7.10",t);default:return["iframe_ready","iframe_will_reload","web_app_close","web_app_data_send","web_app_expand","web_app_open_link","web_app_ready","web_app_request_theme","web_app_request_viewport","web_app_setup_main_button","web_app_setup_closing_behavior"].includes(e)}}function io(e,t){t||(t="strict");const n=typeof t=="function"?t:r=>{const{method:o,version:s}=r;let i,a;if("param"in r?(i=`Parameter "${r.param}" of "${o}" method is unsupported in Mini Apps version ${s}`,a=Gr):(i=`Method "${o}" is unsupported in Mini Apps version ${s}`,a=Jr),t==="strict")throw new p(a,i);return console.warn(i)};return(r,o)=>D(r,e)?Tr(o)&&r==="web_app_set_header_color"&&"color"in o&&!D(r,"color",e)?n({version:e,method:r,param:"color"}):it(r,o):n({version:e,method:r})}function ao(e,t,n,r){return at("web_app_invoke_custom_method","custom_method_invoked",{...r||{},params:{method:e,params:t,req_id:n},capture:oo(n)}).then(({result:o,error:s})=>{if(s)throw new p(zr,s);return o})}function co(){return performance.getEntriesByType("navigation")[0]}function P(){const e=co();return!!e&&e.type==="reload"}let q;function uo(e,t){q&&q.set(e,t)||t()}function lo(e){if(q)return e();q=new Map;try{e()}finally{q.forEach(t=>t()),q=void 0}}function u(e,t){t||(t={});const n=t.equals||Object.is;let r=[],o=e;const s=c=>{if(!n(o,c)){const f=o;o=c,uo(l,()=>{[...r].forEach(([b,m])=>{b(c,f),m&&a(b,!0)})})}};function i(c){const f=typeof c!="object"?{once:c}:c;return{once:f.once||!1,signal:f.signal||!1}}const a=(c,f)=>{const b=i(f),m=r.findIndex(([$,E])=>$===c&&E.once===b.once&&E.signal===b.signal);m>=0&&r.splice(m,1)},l=Object.assign(function(){return po(l),o},{destroy(){r=[]},set:s,reset(){s(e)},sub(c,f){return r.push([c,i(f)]),()=>a(c,f)},unsub:a,unsubAll(){r=r.filter(c=>c[1].signal)}});return l}const Y=[];function po(e){Y.length&&Y[Y.length-1].add(e)}function g(e,t){let n=new Set,r;function o(){return r||(r=u(i(),t))}function s(){o().set(i())}function i(){n.forEach(c=>{c.unsub(s,{signal:!0})});const a=new Set;let l;Y.push(a);try{l=e()}finally{Y.pop()}return a.forEach(c=>{c.sub(s,{signal:!0})}),n=a,l}return Object.assign(function(){return o()()},{destroy(){o().destroy()},sub(...a){return o().sub(...a)},unsub(...a){o().unsub(...a)},unsubAll(...a){o().unsubAll(...a)}})}const fo=u((()=>{let e=0;return()=>(e+=1).toString()})()),wn=u(it),V=u("0.0");function _o(e){e||(e={});const{postEvent:t}=e,n=e.version||fe().version;V.set(n),wn.set(typeof t=="function"?t:io(n))}function ho(){return fo()()}function Se(e,t,n){return ao(e,t,ho(),{...n||{},postEvent:d})}const L=(e,t,n)=>(n||(n={}),n.postEvent||(n.postEvent=d),at(e,t,n)),d=(e,t)=>wn()(e,t);function ct(e){return g(()=>D(e,V()))}const G="ERR_POPUP_INVALID_PARAMS",ut="ERR_INVALID_URL",bo="ERR_INVALID_SLUG",yn="ERR_ALREADY_REQUESTING",lt="ERR_ALREADY_OPENED",go="ERR_ALREADY_MOUNTING",mo="ERR_VARS_ALREADY_BOUND",wo="ERR_NOT_AVAILABLE",yo="ERR_NOT_INITIALIZED",qt="ERR_NOT_SUPPORTED",vo="ERR_NOT_MOUNTED";function Wt(){return typeof window>"u"}function vn(e,t,{isSupported:n,isMounted:r,component:o,supports:s}={}){const i=`${o?`${o}.`:""}${e}()`;n=n?Array.isArray(n)||typeof n=="object"&&"any"in n?n:[n]:void 0;function a(h){if(s){const _=s[h];return D(_[0],_[1],V())}return!0}const l=()=>{if(!n)return;const h=`it is unsupported in Mini Apps version ${V()}`;function _(S){return typeof S=="string"?D(S,V())?void 0:h:S.fn()?void 0:S.error}if(Array.isArray(n)){for(const S of n){const It=_(S);if(It)return It}return}let B;for(const S of n.any)if(B=_(S),!B)return;return h},c=(...h)=>{if(s){for(const _ in s)if(s[_][2](...h)&&!a(_))return`option ${_} is not supported in Mini Apps version ${V()}`}},f=g(()=>!l()),b=g(()=>V()!=="0.0"),m=g(()=>!r||r()),$=g(()=>Mt("simple")&&!Wt()&&b()&&f()&&m());let E;if(s){E={};for(const h in s)E[h]=g(()=>a(h))}return Object.assign((...h)=>{const _=`Unable to call the ${i} ${o?"method":"function"}:`;if(Wt()||!Mt("simple"))throw new p(hn,`${_} it can't be called outside Mini Apps`);if(!b())throw new p(yo,`${_} the SDK was not initialized. Use the SDK init() function`);const B=l();if(B)throw new p(qt,`${_} ${B}`);const S=c(...h);if(S)throw new p(qt,`${_} ${S}`);if(!m())throw new p(vo,`${_} the component is not mounted. Use the ${o}.mount() method`);return t(...h)},t,{isAvailable:$,ifAvailable(...h){return $()?t(...h):void 0}},n?{isSupported:f}:{},E?{supports:E}:{})}function Ae(e,t){return t||(t={}),(n,r,o,s)=>vn(n,r,{...t,isSupported:o||t.isSupported,supports:s,component:e})}function F(e,t,n){return Ae(e,{isSupported:n,isMounted:t})}function x(e,t){return Ae(e,{isSupported:t})}const ke="web_app_setup_back_button",En="back_button_pressed",Re="backButton",Ke=u(!1),re=u(!1),Eo=ct(ke),Cn=F(Re,re,ke),pt=x(Re,ke),Co=Cn("hide",()=>{ft(!1)}),So=pt("mount",()=>{re()||(ft(P()&&R(Re)||!1),re.set(!0))});function ft(e){e!==Ke()&&(d(ke,{is_visible:e}),k(Re,e),Ke.set(e))}const Ao=pt("onClick",e=>C(En,e)),ko=pt("offClick",e=>{de(En,e)}),Ro=Cn("show",()=>{ft(!0)});function xo(){re.set(!1)}const be=Object.freeze(Object.defineProperty({__proto__:null,hide:Co,isMounted:re,isSupported:Eo,isVisible:Ke,mount:So,offClick:ko,onClick:Ao,show:Ro,unmount:xo},Symbol.toStringTag,{value:"Module"}));function Sn(e,t,n,{isMounting:r,isMounted:o,mountError:s}){return i=>v.withFn(async a=>{if(o())return;if(r())throw new p(go,`The ${e} component is already mounting`);r.set(!0);let l;try{l=[!0,await t({abortSignal:a})]}catch(c){l=[!1,c]}lo(()=>{if(r.set(!1),o.set(!0),l[0])n(l[1]);else{const c=l[1];throw s.set(c),c}})},i)}const I=Ae,An=u(),Ue=u(!1),qe=u(!1),kn=u(!1),To=u(!1),Oo=u(void 0);function dt(e){return e.available?{available:!0,tokenSaved:e.token_saved,deviceId:e.device_id,accessRequested:e.access_requested,type:e.type,accessGranted:e.access_granted}:{available:!1}}const Ht="web_app_biometry_get_info",Po=vn("requestBiometry",e=>L(Ht,"biometry_info_received",e).then(dt),{isSupported:Ht}),_t="web_app_biometry_request_auth",$o="web_app_biometry_request_access",Vo="web_app_biometry_open_settings",Io="web_app_biometry_update_token",Rn="biometry_info_received",W="biometry",jo=I(W),Bo=x(W,_t),ht=F(W,kn,_t);function xn(){throw new p(wo,"Biometry is not available")}ht("authenticate",e=>v.withFn(async t=>{if(Ue())throw new p(yn,"Authentication is already in progress");const n=An();(!n||!n.available)&&xn(),Ue.set(!0);try{const r=await L(_t,"biometry_auth_requested",{abortSignal:t,params:{reason:((e||{}).reason||"").trim()}}),{token:o}=r;return typeof o=="string"&&xe({...n,token:o}),r}finally{Ue.set(!1)}},e));Bo("openSettings",()=>{d(Vo)});ht("requestAccess",e=>v.withFn(async t=>{if(qe())throw new p(yn,"Access request is already in progress");qe.set(!0);try{const n=await L($o,Rn,{abortSignal:t,params:{reason:(e||{}).reason||""}}).then(dt);return n.available||xn(),xe(n),n.accessGranted}finally{qe.set(!1)}},e));jo("mount",Sn(W,e=>P()&&R(W)||Po(e),e=>{C(Rn,No),xe(e)},{isMounted:kn,mountError:Oo,isMounting:To}));const No=e=>{xe(dt(e))};function xe(e){An.set(e),k(W,e)}ht("updateToken",e=>(e||(e={}),L(Io,"biometry_token_updated",{...e,params:{token:e.token||"",reason:e.reason}}).then(t=>t.status)));function Te(e,t){return Ae(e,{isMounted:t})}const Oe="closingBehavior",Jt=u(!1),Ye=u(!1),Tn=Te(Oe,Ye),Do=I(Oe);Tn("disableConfirmation",()=>{bt(!1)});Tn("enableConfirmation",()=>{bt(!0)});Do("mount",()=>{Ye()||(bt(P()&&R(Oe)||!1),Ye.set(!0))});function bt(e){e!==Jt()&&(d("web_app_setup_closing_behavior",{need_confirmation:e}),k(Oe,e),Jt.set(e))}const On="web_app_invoke_custom_method",Pe=x("cloudStorage",On),Lo=ct(On),Mo=Pe("deleteItem",(e,t)=>{const n=Array.isArray(e)?e:[e];return n.length?Se("deleteStorageValues",{keys:n},t).then():v.resolve()});function Uo(e,t){const n=Array.isArray(e)?e:[e];return n.length?Se("getStorageValues",{keys:n},t).then(r=>{const o=ur(Object.fromEntries(n.map(s=>[s,nt()])))()(r);return Array.isArray(e)?o:o[e]}):v.resolve(typeof e=="string"?"":{})}const qo=Pe("getItem",Uo),Wo=Pe("getKeys",e=>Se("getStorageKeys",{},e).then(dr(nt())())),Ho=Pe("setItem",(e,t,n)=>Se("saveStorageValue",{key:e,value:t},n).then()),ge=Object.freeze(Object.defineProperty({__proto__:null,deleteItem:Mo,getItem:qo,getKeys:Wo,isSupported:Lo,setItem:Ho},Symbol.toStringTag,{value:"Module"})),_e="web_app_trigger_haptic_feedback",gt=x("hapticFeedback",_e),Jo=ct(_e),Fo=gt("impactOccurred",e=>{d(_e,{type:"impact",impact_style:e})}),Pn=gt("notificationOccurred",e=>{d(_e,{type:"notification",notification_type:e})}),Go=gt("selectionChanged",()=>{d(_e,{type:"selection_change"})}),zo=Object.freeze(Object.defineProperty({__proto__:null,impactOccurred:Fo,isSupported:Jo,notificationOccurred:Pn,selectionChanged:Go},Symbol.toStringTag,{value:"Module"})),$n="web_app_open_invoice",Ko=x("invoice",$n),We=u(!1);async function Yo(e,t,n){if(We())throw new p(lt,"An invoice is already opened");let r;if(t==="url"){const{hostname:o,pathname:s}=new URL(e,window.location.href);if(o!=="t.me")throw new p(ut,`Link has unexpected hostname: ${o}`);const i=s.match(/^\/(\$|invoice\/)([A-Za-z0-9\-_=]+)$/);if(!i)throw new p(bo,'Expected to receive a link with a pathname in format "/invoice/{slug}" or "/${slug}"');[,,r]=i}else r=e,n=t;return We.set(!0),L($n,"invoice_closed",{...n,params:{slug:r},capture:o=>r===o.slug}).then(o=>o.status).finally(()=>{We.set(!1)})}Ko("open",Yo);function Vn(e){const t=en(e);return Math.sqrt([.299,.587,.114].reduce((n,r,o)=>{const s=parseInt(t.slice(1+o*2,1+(o+1)*2),16);return n+s*s*r},0))<120}const oe=u(!1),me=u(!1),j=u({});function y(e){return g(()=>j()[e])}const Zo=y("accentTextColor"),mt=y("bgColor"),wt=y("buttonColor"),In=y("buttonTextColor"),jn=y("bottomBarBgColor"),Xo=y("destructiveTextColor"),Qo=y("headerBgColor"),es=y("hintColor"),ts=g(()=>{const{bgColor:e}=j();return!e||Vn(e)}),ns=y("linkColor"),Ee=y("secondaryBgColor"),rs=y("sectionBgColor"),os=y("sectionHeaderTextColor"),ss=y("sectionSeparatorColor"),is=y("subtitleTextColor"),as=y("textColor");function M(e){return g(()=>yt()[e])}const Z=u({hasShineEffect:!1,isEnabled:!0,isLoaderVisible:!1,isVisible:!1,text:"Continue"}),yt=g(()=>{const e=Z();return{...e,backgroundColor:e.backgroundColor||wt()||"#2481cc",textColor:e.textColor||In()||"#ffffff"}}),se=u(!1),cs=M("backgroundColor"),us=M("hasShineEffect"),ls=M("isEnabled"),ps=M("isLoaderVisible"),fs=M("isVisible"),ds=M("text"),_s=M("textColor"),hs="web_app_setup_main_button",Bn="main_button_pressed",$e="mainButton",vt=I($e),bs=Te($e,se),gs=vt("mount",()=>{if(!se()){const e=P()&&R($e);e&&Z.set(e),se.set(!0)}}),ms=vt("onClick",e=>C(Bn,e)),ws=vt("offClick",e=>{de(Bn,e)}),ys=bs("setParams",e=>{Z.set({...Z(),...Object.fromEntries(Object.entries(e).filter(([,n])=>n!==void 0))}),k($e,Z());const t=yt();t.text&&d(hs,{color:t.backgroundColor,has_shine_effect:t.hasShineEffect,is_active:t.isEnabled,is_progress_visible:t.isLoaderVisible,is_visible:t.isVisible,text:t.text,text_color:t.textColor})});function vs(){se.set(!1)}const U=Object.freeze(Object.defineProperty({__proto__:null,backgroundColor:cs,hasShineEffect:us,isEnabled:ls,isLoaderVisible:ps,isMounted:se,isVisible:fs,mount:gs,offClick:ws,onClick:ms,setParams:ys,state:yt,text:ds,textColor:_s,unmount:vs},Symbol.toStringTag,{value:"Module"}));function Et(){throw new p(mo,"CSS variables are already bound")}function Es(e){return fr()(e)}const Ve="themeParams",Nn="theme_changed",Cs=I(Ve),Ss=Te(Ve,oe),As=Ss("bindCssVars",e=>{me()&&Et(),e||(e=r=>`--tg-theme-${rt(r)}`);function t(r){Object.entries(j()).forEach(([o,s])=>{s&&r(o,s)})}function n(){t((r,o)=>{ot(e(r),o)})}return n(),j.sub(n),me.set(!0),()=>{t(st),j.unsub(n),me.set(!1)}}),Dn=Cs("mount",()=>{oe()||(C(Nn,Ln),j.set(P()&&R(Ve)||fe().themeParams),oe.set(!0))}),Ln=e=>{const t=Es(e.theme_params);j.set(t),k(Ve,t)};function ks(){de(Nn,Ln),oe.set(!1)}function Mn(e){return g(()=>{const t=e();return ee(t)?t:t==="bg_color"?mt():Ee()})}const ie=u("bg_color"),Ct=Mn(ie),ae=u("bottom_bar_bg_color"),St=g(()=>{const e=ae();return ee(e)?e:e==="bottom_bar_bg_color"?jn()||Ee():e==="secondary_bg_color"?Ee():mt()}),ce=u("bg_color"),Un=Mn(ce),ue=u(!1),we=u(!1),Rs=g(()=>{const e=Ct();return e?Vn(e):!1}),qn=g(()=>({backgroundColor:ie(),bottomBarColor:ae(),headerColor:ce()})),Ze="web_app_set_background_color",Xe="web_app_set_bottom_bar_color",ye="web_app_set_header_color",he="miniApp",At={any:[Ze,Xe,ye]},xs=g(()=>At.any.some(e=>D(e,V()))),Wn=I(he),Ts=x(he,At),Ie=F(he,ue,At),Os=Ie("bindCssVars",e=>{we()&&Et();const[t,n]=H();function r(o,s){function i(){ot(o,s()||null)}i(),t(s.sub(i),st.bind(null,o))}return e||(e=o=>`--tg-${rt(o)}`),r(e("bgColor"),Ct),r(e("bottomBarColor"),St),r(e("headerColor"),Un),t(()=>{we.set(!1)}),we.set(!0),n}),Hn=Wn("close",e=>{d("web_app_close",{return_back:e})}),Ps=Ts("mount",()=>{if(!ue()){const e=P()&&R(he);Dn(),Jn.ifAvailable(e?e.backgroundColor:"bg_color"),Fn.ifAvailable(e?e.bottomBarColor:"bottom_bar_bg_color"),Gn.ifAvailable(e?e.headerColor:"bg_color"),ue.set(!0)}}),$s=Wn("ready",()=>{d("web_app_ready")});function kt(){k(he,qn())}const Jn=Ie("setBackgroundColor",e=>{e!==ie()&&(d(Ze,{color:e}),ie.set(e),kt())},Ze),Fn=Ie("setBottomBarColor",e=>{e!==ae()&&(d(Xe,{color:e}),ae.set(e),kt())},Xe),Gn=Ie("setHeaderColor",e=>{e!==ce()&&(d(ye,ee(e)?{color:e}:{color_key:e}),ce.set(e),kt())},ye,{rgb:[ye,"color",ee]});function Vs(){ue.set(!1)}const Is=Object.freeze(Object.defineProperty({__proto__:null,backgroundColor:ie,backgroundColorRGB:Ct,bindCssVars:Os,bottomBarColor:ae,bottomBarColorRGB:St,close:Hn,headerColor:ce,headerColorRGB:Un,isCssVarsBound:we,isDark:Rs,isMounted:ue,isSupported:xs,mount:Ps,ready:$s,setBackgroundColor:Jn,setBottomBarColor:Fn,setHeaderColor:Gn,state:qn,unmount:Vs},Symbol.toStringTag,{value:"Module"}));function js(e){const t=e.message.trim(),n=(e.title||"").trim(),r=e.buttons||[];if(n.length>64)throw new p(G,`Invalid title: ${n}`);if(!t||t.length>256)throw new p(G,`Invalid message: ${t}`);if(r.length>3)throw new p(G,`Invalid buttons count: ${r.length}`);return{title:n,message:t,buttons:r.length?r.map((o,s)=>{const i=o.id||"";if(i.length>64)throw new p(G,`Button with index ${s} has invalid id: ${i}`);if(!o.type||o.type==="default"||o.type==="destructive"){const a=o.text.trim();if(!a||a.length>64)throw new p(G,`Button with index ${s} has invalid text: ${a}`);return{type:o.type,text:a,id:i}}return{type:o.type,id:i}}):[{type:"close",id:""}]}}const zn="web_app_open_popup",Bs=x("popup",zn),He=u(!1);Bs("open",async e=>{if(He())throw new p(lt,"A popup is already opened");He.set(!0);try{const{button_id:t=null}=await L(zn,"popup_closed",{...e,params:js(e)});return t}finally{He.set(!1)}});const Ns="web_app_close_scan_qr_popup",Kn="web_app_open_scan_qr_popup",Ds="scan_qr_popup_closed",Ls="qr_text_received",Yn=x("qrScanner",Kn),Ft=Yn("close",()=>{z.set(!1),d(Ns)}),z=u(!1);function Ms(e){return v.withFn(t=>{if(z())throw new p(lt,"The QR Scanner is already opened");z.set(!0),e||(e={});const{onCaptured:n,text:r,capture:o}=e,[,s]=H(z.sub(()=>{i.resolve()}),C(Ds,()=>{z.set(!1)}),C(Ls,a=>{n?n(a.data):(!o||o(a.data))&&(i.resolve(a.data),Ft())})),i=new K({abortSignal:t}).catch(Ft).finally(s);return(e.postEvent||d)(Kn,{text:r}),i},e)}Yn("open",Ms);const X=u({hasShineEffect:!1,isEnabled:!0,isLoaderVisible:!1,isVisible:!1,position:"left",text:"Cancel"}),Us=g(()=>{const e=X();return{...e,backgroundColor:e.backgroundColor||St()||"#000000",textColor:e.textColor||wt()||"#2481cc"}}),Qe=u(!1),Rt="web_app_setup_secondary_button",Zn="secondary_button_pressed",je="secondaryButton",xt=x(je,Rt),qs=F(je,Qe,Rt);xt("mount",()=>{if(!Qe()){const e=P()&&R(je);e&&X.set(e),Qe.set(!0)}});xt("onClick",e=>C(Zn,e));xt("offClick",e=>{de(Zn,e)});qs("setParams",e=>{X.set({...X(),...Object.fromEntries(Object.entries(e).filter(([,n])=>n!==void 0))}),k(je,X());const t=Us();t.text&&d(Rt,{color:t.backgroundColor,has_shine_effect:t.hasShineEffect,is_active:t.isEnabled,is_progress_visible:t.isLoaderVisible,is_visible:t.isVisible,position:t.position,text:t.text,text_color:t.textColor})});const Tt="web_app_setup_settings_button",Xn="settings_button_pressed",Be="settingsButton",Gt=u(!1),et=u(!1),Ot=x(Be,Tt),Qn=F(Be,et,Tt);Qn("hide",()=>{Pt(!1)});Ot("mount",()=>{et()||(Pt(P()&&R(Be)||!1),et.set(!0))});function Pt(e){e!==Gt()&&(d(Tt,{is_visible:e}),k(Be,e),Gt.set(e))}Ot("onClick",e=>C(Xn,e));Ot("offClick",e=>{de(Xn,e)});Qn("show",()=>{Pt(!0)});const $t="web_app_setup_swipe_behavior",Ne="swipeBehavior",tt=u(!1),zt=u(!0),Ws=x(Ne,$t),er=F(Ne,tt,$t);er("disableVertical",()=>{Vt(!1)});er("enableVertical",()=>{Vt(!0)});Ws("mount",()=>{tt()||(Vt(P()&&R(Ne)||!1,!0),tt.set(!0))});function Vt(e,t){(e!==zt()||t)&&(d($t,{allow_vertical_swipe:e}),k(Ne,e),zt.set(e))}const Je=Object.freeze(Object.defineProperty({__proto__:null,accentTextColor:Zo,backgroundColor:mt,bindCssVars:As,bottomBarBgColor:jn,buttonColor:wt,buttonTextColor:In,destructiveTextColor:Xo,headerBackgroundColor:Qo,hintColor:es,isCssVarsBound:me,isDark:ts,isMounted:oe,linkColor:ns,mount:Dn,secondaryBackgroundColor:Ee,sectionBackgroundColor:rs,sectionHeaderTextColor:os,sectionSeparatorColor:ss,state:j,subtitleTextColor:is,textColor:as,unmount:ks},Symbol.toStringTag,{value:"Module"})),N=u({height:0,width:0,isExpanded:!1,stableHeight:0}),tr=u(!1),Fe=u(!1),Hs=u(!1),Js=u(void 0);function Fs(e){return L("web_app_request_viewport","viewport_changed",e).then(t=>({height:t.height,width:t.width,isExpanded:t.is_expanded,isStable:t.is_state_stable}))}const Ce="viewport",nr=I(Ce),Gs=Te(Ce,tr);Gs("bindCssVars",e=>{Fe()&&Et(),e||(e=r=>`--tg-viewport-${rt(r)}`);const t=["height","width","stableHeight"];function n(){t.forEach(r=>{ot(e(r),`${N()[r]}px`)})}return n(),N.sub(n),Fe.set(!0),()=>{t.forEach(st),N.unsub(n),Fe.set(!1)}});nr("expand",()=>{d("web_app_expand")});nr("mount",Sn(Ce,e=>{const t=P()&&R(Ce);if(t)return t;if(["macos","tdesktop","unigram","webk","weba","web"].includes(fe().platform)){const n=window;return{isExpanded:!0,height:n.innerHeight,width:n.innerWidth,stableHeight:n.innerHeight}}return e.timeout||(e.timeout=1e3),Fs(e).then(n=>({height:n.height,isExpanded:n.isExpanded,stableHeight:n.isStable?n.height:N().stableHeight,width:n.width}))},e=>{C("viewport_changed",zs),rr(e)},{isMounted:tr,isMounting:Hs,mountError:Js}));const zs=e=>{rr({height:e.height,isExpanded:e.is_expanded,stableHeight:e.is_state_stable?e.height:N().stableHeight,width:e.width})};function rr(e){N.set({isExpanded:e.isExpanded,height:Ge(e.height),width:Ge(e.width),stableHeight:Ge(e.stableHeight)}),k("viewport",N())}function Ge(e){return Math.max(e,0)}const Ks=I();Ks("openLink",(e,t)=>{if(typeof e=="string")try{e=new URL(e)}catch(n){throw new p(ut,`"${e.toString()}" is invalid URL`,n)}t||(t={}),d("web_app_open_link",{url:e.toString(),try_browser:t.tryBrowser,try_instant_view:t.tryInstantView})});const Kt="web_app_open_tg_link",Ys=I(),Zs=Ys("openTelegramLink",e=>{const t=e.toString();if(!t.match(/^https:\/\/t.me\/.+/))throw new p(ut,`"${t}" is invalid URL`);if(!D(Kt,V())){window.location.href=t;return}e=new URL(e),d(Kt,{path_full:e.pathname+e.search})}),Xs=I();Xs("shareURL",(e,t)=>{Zs("https://t.me/share/url?"+new URLSearchParams({url:e,text:t||""}).toString().replace(/\+/g,"%20"))});function Qs(e){_o(e),no();const[t,n]=H(C("reload_iframe",()=>{d("iframe_will_reload"),window.location.reload()}),ro),{acceptCustomStyles:r=!0}={};if(r){const o=document.createElement("style");o.id="telegram-custom-styles",document.head.appendChild(o),t(C("set_custom_style",s=>{o.innerHTML=s}),()=>{document.head.removeChild(o)})}return d("iframe_ready",{reload_supported:!0}),n}class ei{closeWith(t){Pn(t),Is.close.isAvailable()&&Hn()}getInitData(){const{initData:t}=fe();if(t===void 0)throw"Could not retrieve Telegram Launch Parameters";return t}init(t){Qs(),be.mount(),U.mount(),Je.mount(),Je.isCssVarsBound()||Je.bindCssVars(),t==="/"?be.hide():be.show(),be.onClick(()=>window.history.back())}setMainButtonText(t){U.setParams({text:t})}onMainButtonClick(t){U.onClick(t)}showMainButton(t){this.setMainButtonText(t),U.setParams({isVisible:!0})}offMainButtonClick(t){U.offClick(t)}hideMainButton(){U.setParams({isVisible:!1})}envokeHaptic(t){zo.impactOccurred(t)}async addToStorage(t,n){try{return await ge.setItem(t,n)}catch(r){alert(r)}}async getKeys(){return await ge.getKeys()}async getItem(t){return await ge.getItem(t)}async deleteItem(t){return await ge.deleteItem(t)}async findInArrayItem(t,n,r){let o=await this.getItem(t),s=[];return o.length&&(s=JSON.parse(o)),s.find(i=>i[r]===n)}async removeFromArrayItem(t,n,r){let o=await this.getItem(t),s=[];o.length&&(s=JSON.parse(o));let i=[];return i=s.filter(a=>a[r]!==n),this.addToStorage(t,JSON.stringify(i)),i}async addToArrayItem(t,n){let r=await this.getItem(t),o=[];r.length&&(o=JSON.parse(r));let s=[];return s=o.concat(n),this.addToStorage(t,JSON.stringify(s)),s}}const ti=new ei;export{ti as t};
