let X=class Gt extends Error{constructor(t,n,r){super(typeof n=="object"?n.message:n||t,{cause:typeof n=="object"?n.cause:r}),this.type=t,Object.setPrototypeOf(this,Gt.prototype)}};function Zn(e){return e.replace(/_[a-z]/g,t=>t[1].toUpperCase())}const Xn="ERR_INVALID_VALUE",Qn="ERR_UNEXPECTED_VALUE",er="ERR_UNEXPECTED_TYPE",zt="ERR_PARSE";function tr(e,t){const n={};for(const r in e){const o=e[r];if(!o)continue;let s,i;typeof o=="function"?(s=r,i=o):[s,i]=o;try{const a=i(t(s));a!==void 0&&(n[r]=a)}catch(a){throw new X(zt,`Parser for "${r}" property failed${s===r?"":`. Source field: "${s}"`}`,a)}}return n}function Kt(e){let t=e;if(typeof t=="string")try{t=JSON.parse(t)}catch(n){throw new X(Xn,{cause:n})}if(typeof t!="object"||!t||Array.isArray(t))throw new X(Qn);return t}function ce(e,t){return n=>{const r=o=>{if(!(n&&o===void 0))try{return t(o)}catch(s){throw new X(zt,{message:`"${e}" transformer failed to parse the value`,cause:s})}};return Object.assign(r,{isValid(o){try{return r(o),!0}catch{return!1}}})}}function nr(e,t){return ce("object",n=>{const r=Kt(n);return tr(e,o=>r[o])})}function Yt(e){throw new X(er,`Unexpected value received: ${JSON.stringify(e)}`)}const tt=ce("string",e=>{if(typeof e=="string"||typeof e=="number")return e.toString();Yt(e)});function Q(e){return/^#[\da-f]{6}$/i.test(e)}function rr(e){return/^#[\da-f]{3}$/i.test(e)}function Zt(e){const t=e.replace(/\s/g,"").toLowerCase();if(Q(t))return t;if(rr(t)){let r="#";for(let o=0;o<3;o+=1)r+=t[1+o].repeat(2);return r}const n=t.match(/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/)||t.match(/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),\d{1,3}\)$/);if(!n)throw new Error(`Value "${e}" does not satisfy any of known RGB formats.`);return n.slice(1).reduce((r,o)=>{const s=parseInt(o,10).toString(16);return r+(s.length===1?"0":"")+s},"#")}const or=ce("rgb",e=>Zt(tt()(e))),sr=ce("themeParams",e=>{const t=or(!0);return Object.entries(Kt(e)).reduce((n,[r,o])=>(n[Zn(r)]=t(o),n),{})});function ir(e,t){return ce("array",n=>{let r;if(Array.isArray(n))r=n;else if(typeof n=="string")try{const o=JSON.parse(n);Array.isArray(o)&&(r=o)}catch{}return r||Yt(n),r.map(e)})}let ee=class Xt extends Error{constructor(t,n,r){super(typeof n=="object"?n.message:n||t,{cause:typeof n=="object"?n.cause:r}),this.type=t,Object.setPrototypeOf(this,Xt.prototype)}};function Qt(e){return e.replace(/[A-Z]/g,t=>`_${t.toLowerCase()}`)}function ar(e){return e.replace(/_[a-z]/g,t=>t[1].toUpperCase())}const cr="ERR_INVALID_VALUE",ur="ERR_UNEXPECTED_VALUE",pr="ERR_UNEXPECTED_TYPE",en="ERR_PARSE";function tn(e,t){const n={};for(const r in e){const o=e[r];if(!o)continue;let s,i;typeof o=="function"?(s=r,i=o):[s,i]=o;try{const a=i(t(s));a!==void 0&&(n[r]=a)}catch(a){throw new ee(en,`Parser for "${r}" property failed${s===r?"":`. Source field: "${s}"`}`,a)}}return n}function nn(e){let t=e;if(typeof t=="string")try{t=JSON.parse(t)}catch(n){throw new ee(cr,{cause:n})}if(typeof t!="object"||!t||Array.isArray(t))throw new ee(ur);return t}function P(e,t){return n=>{const r=o=>{if(!(n&&o===void 0))try{return t(o)}catch(s){throw new ee(en,{message:`"${e}" transformer failed to parse the value`,cause:s})}};return Object.assign(r,{isValid(o){try{return r(o),!0}catch{return!1}}})}}function O(e,t){return P(t||"object",n=>{const r=nn(n);return tn(e,o=>r[o])})}function ue(e){throw new ee(pr,`Unexpected value received: ${JSON.stringify(e)}`)}const ge=P("boolean",e=>{if(typeof e=="boolean")return e;const t=String(e);if(t==="1"||t==="true")return!0;if(t==="0"||t==="false")return!1;ue(e)}),A=P("string",e=>{if(typeof e=="string"||typeof e=="number")return e.toString();ue(e)}),te=P("number",e=>{if(typeof e=="number")return e;if(typeof e=="string"){const t=Number(e);if(!Number.isNaN(t))return t}ue(e)}),lr=P("date",e=>e instanceof Date?e:new Date(te()(e)*1e3));function rn(e,t){return P(t||"searchParams",n=>{typeof n!="string"&&!(n instanceof URLSearchParams)&&ue(n);const r=typeof n=="string"?new URLSearchParams(n):n;return tn(e,o=>{const s=r.get(o);return s===null?void 0:s})})}function je(e){for(const t in e)e[t]=[Qt(t),e[t]];return e}const fr=e=>{const t=te(),n=te(!0),r=A(),o=A(!0),s=ge(!0),i=O(je({addedToAttachmentMenu:s,allowsWriteToPm:s,firstName:r,id:t,isBot:s,isPremium:s,languageCode:o,lastName:o,photoUrl:o,username:o}),"User")(!0);return rn(je({authDate:lr(),canSendAfter:n,chat:O(je({id:t,type:r,title:r,photoUrl:o,username:o}),"Chat")(!0),chatInstance:o,chatType:o,hash:r,queryId:o,receiver:i,startParam:o,user:i}),"initData")(e)};function _r(e){return/^#[\da-f]{6}$/i.test(e)}function dr(e){return/^#[\da-f]{3}$/i.test(e)}function hr(e){const t=e.replace(/\s/g,"").toLowerCase();if(_r(t))return t;if(dr(t)){let r="#";for(let o=0;o<3;o+=1)r+=t[1+o].repeat(2);return r}const n=t.match(/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/)||t.match(/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),\d{1,3}\)$/);if(!n)throw new Error(`Value "${e}" does not satisfy any of known RGB formats.`);return n.slice(1).reduce((r,o)=>{const s=parseInt(o,10).toString(16);return r+(s.length===1?"0":"")+s},"#")}const br=P("rgb",e=>hr(A()(e))),mr=P("themeParams",e=>{const t=br(!0);return Object.entries(nn(e)).reduce((n,[r,o])=>(n[ar(r)]=t(o),n),{})});function gr(e){return JSON.stringify(Object.fromEntries(Object.entries(e).map(([t,n])=>[Qt(t),n])))}const wr=e=>{const t=A(),n=A(!0),r=ge(!0);return rn({botInline:["tgWebAppBotInline",r],initData:["tgWebAppData",fr(!0)],initDataRaw:["tgWebAppData",n],platform:["tgWebAppPlatform",t],showSettings:["tgWebAppShowSettings",r],startParam:["tgWebAppStartParam",n],themeParams:["tgWebAppThemeParams",mr()],version:["tgWebAppVersion",t]},"launchParams")(e)};function yr(e){const{initDataRaw:t,startParam:n,showSettings:r,botInline:o}=e,s=new URLSearchParams;return s.set("tgWebAppPlatform",e.platform),s.set("tgWebAppThemeParams",gr(e.themeParams)),s.set("tgWebAppVersion",e.version),t&&s.set("tgWebAppData",t),n&&s.set("tgWebAppStartParam",n),typeof r=="boolean"&&s.set("tgWebAppShowSettings",r?"1":"0"),typeof o=="boolean"&&s.set("tgWebAppBotInline",o?"1":"0"),s.toString()}const vr=O({eventType:A(),eventData:e=>e},"miniAppsMessage"),on=P("fn",e=>{if(typeof e=="function")return e;ue(e)});function Er(e){return!!e&&typeof e=="object"&&!Array.isArray(e)}const Sr=O({TelegramWebviewProxy:O({postEvent:on()})()});function sn(e){return Sr().isValid(e)}function Ar(){try{return window.self!==window.top}catch{return!0}}var Cr=Object.defineProperty,Rr=(e,t,n)=>t in e?Cr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,an=(e,t,n)=>Rr(e,typeof t!="symbol"?t+"":t,n);let l=class cn extends Error{constructor(t,n,r){super(typeof n=="object"?n.message:n||t,{cause:typeof n=="object"?n.cause:r}),this.type=t,Object.setPrototypeOf(this,cn.prototype)}};function Je(e,t,n){return e.addEventListener(t,n),()=>e.removeEventListener(t,n)}function W(...e){const t=e.flat(1);return[t.push.bind(t),()=>{t.forEach(n=>{n()})}]}const kr="ERR_ABORTED",Or="ERR_CANCELED",Pr="ERR_TIMED_OUT";function $t(e){return new l(kr,{cause:e})}function It(e,t){return e.reject=t.reject,e}class y extends Promise{constructor(t,n){let r,o;typeof t=="function"?(r=t,o=n):o=t;let s,i;super((a,p)=>{o||(o={});const{abortSignal:c}=o;if(c&&c.aborted)return p($t(c.reason));const[f,b]=W(),m=d=>(...V)=>(b(),d(...V)),T=new AbortController,{signal:v}=T;i=m(d=>{T.abort(d),p(d)}),s=m(a),c&&f(Je(c,"abort",()=>{i($t(c.reason))}));const{timeout:h}=o;if(h){const d=setTimeout(()=>{i(new l(Pr,`Timeout reached: ${h}ms`))},h);f(()=>{clearTimeout(d)})}r&&r(s,i,v)}),an(this,"reject"),this.reject=i}static withFn(t,n){return new y((r,o,s)=>{try{const i=t(s);return i instanceof Promise?i.then(r,o):r(i)}catch(i){o(i)}},n)}static resolve(t){return new y(n=>{n(t)})}static reject(t){return new y((n,r)=>{r(t)})}cancel(){this.reject(new l(Or))}catch(t){return this.then(void 0,t)}finally(t){return It(super.finally(t),this)}then(t,n){return It(super.then(t,n),this)}}function Vt(e,t){return e.resolve=t.resolve,e}class z extends y{constructor(t,n){let r,o;typeof t=="function"?(r=t,o=n):o=t;let s;super((i,a,p)=>{s=i,r&&r(i,a,p)},o),an(this,"resolve"),this.resolve=s}static withFn(t,n){return new z((r,o,s)=>y.withFn(t,{abortSignal:s}).then(r,o),n)}static resolve(t){return new z(n=>{n(t)})}static reject(t){return new z((n,r)=>{r(t)})}catch(t){return this.then(void 0,t)}finally(t){return Vt(super.finally(t),this)}then(t,n){return Vt(super.then(t,n),this)}}function un(e){return`tapps/${e}`}function C(e,t){sessionStorage.setItem(un(e),JSON.stringify(t))}function R(e){const t=sessionStorage.getItem(un(e));try{return t?JSON.parse(t):void 0}catch{}}function nt(e){return e.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`)}function xr(e,t){t||(t={});const{textColor:n,bgColor:r,shouldLog:o=!0}=t;function s(i,...a){if(!o||typeof o=="function"&&!o())return;const p="font-weight:bold;padding:0 5px;border-radius:5px";console[i](`%c${Intl.DateTimeFormat("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3,timeZone:"UTC"}).format(new Date)}%c / %c${e}`,`${p};background-color: lightblue;color:black`,"",`${p};${n?`color:${n};`:""}${r?`background-color:${r}`:""}`,...a)}return[function(...i){s("log",...i)},function(...i){s("error",...i)}]}function rt(e,t){document.documentElement.style.setProperty(e,t)}function ot(e){document.documentElement.style.removeProperty(e)}function Tr(e,t){t()}function H(e,t){t||(t={});const n=t.equals||Object.is;let r=[],o=e;const s=c=>{if(!n(o,c)){const f=o;o=c,Tr(p,()=>{[...r].forEach(([b,m])=>{b(c,f),m&&a(b,!0)})})}};function i(c){const f=typeof c!="object"?{once:c}:c;return{once:f.once||!1,signal:f.signal||!1}}const a=(c,f)=>{const b=i(f),m=r.findIndex(([T,v])=>T===c&&v.once===b.once&&v.signal===b.signal);m>=0&&r.splice(m,1)},p=Object.assign(function(){return $r(p),o},{destroy(){r=[]},set:s,reset(){s(e)},sub(c,f){return r.push([c,i(f)]),()=>a(c,f)},unsub:a,unsubAll(){r=r.filter(c=>c[1].signal)}});return p}const Ne=[];function $r(e){Ne.length&&Ne[Ne.length-1].add(e)}const Ir=H(!1),[pn,Vr]=xr("Bridge",{bgColor:"#9147ff",textColor:"white",shouldLog:Ir}),jr={clipboard_text_received:O({req_id:A(),data:e=>e===null?e:A(!0)(e)},"clipboard_text_received"),custom_method_invoked:O({req_id:A(),result:e=>e,error:A(!0)},"custom_method_invoked"),popup_closed:P("popup_closed",e=>e?O({button_id:t=>t==null?void 0:A()(t)})()(e):{}),viewport_changed:O({height:te(),width:e=>e==null?window.innerWidth:te()(e),is_state_stable:ge(),is_expanded:ge()},"viewport_changed")};function Nr(e){const t=window,[,n]=W(Je(t,"resize",()=>{e(["viewport_changed",{width:window.innerWidth,height:window.innerHeight,is_state_stable:!0,is_expanded:!0}])}),Je(t,"message",r=>{if(r.source!==t.parent)return;let o;try{o=vr()(r.data)}catch{return}const{eventType:s,eventData:i}=o,a=jr[s];try{const p=a?a()(i):i;pn("Event received:",p?{eventType:s,eventData:p}:{eventType:s}),e([s,p])}catch(p){Vr([`An error occurred processing the "${s}" event from the Telegram application.`,"Please, file an issue here:","https://github.com/Telegram-Mini-Apps/telegram-apps/issues/new/choose"].join(`
`),o,p)}}));return n}const jt=H(),Nt=H();function Dr(){return Nt()||Nt.set(Nr(jt.set)),jt}const De=H({});function ln(e){let t=De()[e];return t||(t=H(void 0,{equals(){return!1}}),Dr().sub(n=>{n&&n[0]===e&&t.set(n[1])}),De.set({...De(),[e]:t})),t}function E(e,t,n){return ln(e).sub(t,n)}const Lr="ERR_METHOD_UNSUPPORTED",Mr="ERR_RETRIEVE_LP_FAILED",Br="ERR_METHOD_PARAMETER_UNSUPPORTED",fn="ERR_UNKNOWN_ENV",Ur="ERR_INVOKE_CUSTOM_METHOD_RESPONSE",qr=H("https://web.telegram.org");function st(e,t){pn("Posting event:",t?{eventType:e,eventData:t}:{eventType:e});const n=window;if(sn(n)){n.TelegramWebviewProxy.postEvent(e,JSON.stringify(t));return}const r=JSON.stringify({eventType:e,eventData:t});if(Ar())return n.parent.postMessage(r,qr());const{external:o}=n;if(O({notify:on()})().isValid(o)){o.notify(r);return}throw new l(fn)}function it(e,t,n){n||(n={});const{capture:r}=n,[o,s]=W();return new y(i=>{(Array.isArray(t)?t:[t]).forEach(a=>{o(E(a,p=>{(!r||(Array.isArray(t)?r({event:a,payload:p}):r(p)))&&i(p)}))}),(n.postEvent||st)(e,n.params)},n).finally(s)}function _n(e){return wr()(e)}function dn(e){return _n(e.replace(/^[^?#]*[?#]/,"").replace(/[?#]/g,"&"))}function Wr(){return dn(window.location.href)}function Hr(){const e=performance.getEntriesByType("navigation")[0];if(!e)throw new Error("Unable to get first navigation entry.");return dn(e.name)}const Jr="launchParams";function Fr(){return _n(R(Jr)||"")}function Gr(e){C("launchParams",yr(e))}function hn(e){return e instanceof Error?e.message+(e.cause?`
  ${hn(e.cause)}`:""):JSON.stringify(e)}function pe(){const e=[];for(const t of[Wr,Hr,Fr])try{const n=t();return Gr(n),n}catch(n){e.push(n)}throw new l(Mr,["Unable to retrieve launch parameters from any known source. Perhaps, you have opened your app outside Telegram?","📖 Refer to docs for more information:","https://docs.telegram-mini-apps.com/packages/telegram-apps-sdk/environment","Collected errors:",...e.map(t=>`— ${hn(t)}`)].join(`
`))}function Dt(e){try{return pe(),!0}catch{return!1}return y.withFn(async()=>{if(sn(window))return!0;try{return await it("web_app_request_theme","theme_changed",{timeout:100}),!0}catch{return!1}},e)}function zr(e,t){window.dispatchEvent(new MessageEvent("message",{data:JSON.stringify({eventType:e,eventData:t}),source:window.parent}))}function Kr(){[["TelegramGameProxy_receiveEvent"],["TelegramGameProxy","receiveEvent"],["Telegram","WebView","receiveEvent"]].forEach(e=>{let t=window;e.forEach((n,r,o)=>{if(r===o.length-1){t[n]=zr;return}n in t||(t[n]={}),t=t[n]})})}function Yr(){["TelegramGameProxy_receiveEvent","TelegramGameProxy","Telegram"].forEach(e=>{delete window[e]})}function ye(e,t,n){ln(e).unsub(t,n)}function Zr(e){return({req_id:t})=>t===e}function Lt(e){return e.split(".").map(Number)}function Xr(e,t){const n=Lt(e),r=Lt(t),o=Math.max(n.length,r.length);for(let s=0;s<o;s+=1){const i=n[s]||0,a=r[s]||0;if(i!==a)return i>a?1:-1}return 0}function g(e,t){return Xr(e,t)<=0}function N(e,t,n){if(typeof n=="string"){if(e==="web_app_open_link"){if(t==="try_instant_view")return g("6.4",n);if(t==="try_browser")return g("7.6",n)}if(e==="web_app_set_header_color"&&t==="color")return g("6.9",n);if(e==="web_app_close"&&t==="return_back")return g("7.6",n);if(e==="web_app_setup_main_button"&&t==="has_shine_effect")return g("7.10",n)}switch(e){case"web_app_open_tg_link":case"web_app_open_invoice":case"web_app_setup_back_button":case"web_app_set_background_color":case"web_app_set_header_color":case"web_app_trigger_haptic_feedback":return g("6.1",t);case"web_app_open_popup":return g("6.2",t);case"web_app_close_scan_qr_popup":case"web_app_open_scan_qr_popup":case"web_app_read_text_from_clipboard":return g("6.4",t);case"web_app_switch_inline_query":return g("6.7",t);case"web_app_invoke_custom_method":case"web_app_request_write_access":case"web_app_request_phone":return g("6.9",t);case"web_app_setup_settings_button":return g("6.10",t);case"web_app_biometry_get_info":case"web_app_biometry_open_settings":case"web_app_biometry_request_access":case"web_app_biometry_request_auth":case"web_app_biometry_update_token":return g("7.2",t);case"web_app_setup_swipe_behavior":return g("7.7",t);case"web_app_share_to_story":return g("7.8",t);case"web_app_setup_secondary_button":case"web_app_set_bottom_bar_color":return g("7.10",t);default:return["iframe_ready","iframe_will_reload","web_app_close","web_app_data_send","web_app_expand","web_app_open_link","web_app_ready","web_app_request_theme","web_app_request_viewport","web_app_setup_main_button","web_app_setup_closing_behavior"].includes(e)}}function Qr(e,t){t||(t="strict");const n=typeof t=="function"?t:r=>{const{method:o,version:s}=r;let i,a;if("param"in r?(i=`Parameter "${r.param}" of "${o}" method is unsupported in Mini Apps version ${s}`,a=Br):(i=`Method "${o}" is unsupported in Mini Apps version ${s}`,a=Lr),t==="strict")throw new l(a,i);return console.warn(i)};return(r,o)=>N(r,e)?Er(o)&&r==="web_app_set_header_color"&&"color"in o&&!N(r,"color",e)?n({version:e,method:r,param:"color"}):st(r,o):n({version:e,method:r})}function eo(e,t,n,r){return it("web_app_invoke_custom_method","custom_method_invoked",{...r||{},params:{method:e,params:t,req_id:n},capture:Zr(n)}).then(({result:o,error:s})=>{if(s)throw new l(Ur,s);return o})}function to(){return performance.getEntriesByType("navigation")[0]}function x(){const e=to();return!!e&&e.type==="reload"}let B;function no(e,t){B&&B.set(e,t)||t()}function ro(e){if(B)return e();B=new Map;try{e()}finally{B.forEach(t=>t()),B=void 0}}function u(e,t){t||(t={});const n=t.equals||Object.is;let r=[],o=e;const s=c=>{if(!n(o,c)){const f=o;o=c,no(p,()=>{[...r].forEach(([b,m])=>{b(c,f),m&&a(b,!0)})})}};function i(c){const f=typeof c!="object"?{once:c}:c;return{once:f.once||!1,signal:f.signal||!1}}const a=(c,f)=>{const b=i(f),m=r.findIndex(([T,v])=>T===c&&v.once===b.once&&v.signal===b.signal);m>=0&&r.splice(m,1)},p=Object.assign(function(){return oo(p),o},{destroy(){r=[]},set:s,reset(){s(e)},sub(c,f){return r.push([c,i(f)]),()=>a(c,f)},unsub:a,unsubAll(){r=r.filter(c=>c[1].signal)}});return p}const K=[];function oo(e){K.length&&K[K.length-1].add(e)}function w(e,t){let n=new Set,r;function o(){return r||(r=u(i(),t))}function s(){o().set(i())}function i(){n.forEach(c=>{c.unsub(s,{signal:!0})});const a=new Set;let p;K.push(a);try{p=e()}finally{K.pop()}return a.forEach(c=>{c.sub(s,{signal:!0})}),n=a,p}return Object.assign(function(){return o()()},{destroy(){o().destroy()},sub(...a){return o().sub(...a)},unsub(...a){o().unsub(...a)},unsubAll(...a){o().unsubAll(...a)}})}const so=u((()=>{let e=0;return()=>(e+=1).toString()})()),bn=u(st),$=u("0.0");function io(e){e||(e={});const{postEvent:t}=e,n=e.version||pe().version;$.set(n),bn.set(typeof t=="function"?t:Qr(n))}function ao(){return so()()}function ve(e,t,n){return eo(e,t,ao(),{...n||{},postEvent:_})}const D=(e,t,n)=>(n||(n={}),n.postEvent||(n.postEvent=_),it(e,t,n)),_=(e,t)=>bn()(e,t);function at(e){return w(()=>N(e,$()))}const F="ERR_POPUP_INVALID_PARAMS",ct="ERR_INVALID_URL",co="ERR_INVALID_SLUG",mn="ERR_ALREADY_REQUESTING",ut="ERR_ALREADY_OPENED",uo="ERR_ALREADY_MOUNTING",po="ERR_VARS_ALREADY_BOUND",lo="ERR_NOT_AVAILABLE",fo="ERR_NOT_INITIALIZED",Mt="ERR_NOT_SUPPORTED",_o="ERR_NOT_MOUNTED";function Bt(){return typeof window>"u"}function gn(e,t,{isSupported:n,isMounted:r,component:o,supports:s}={}){const i=`${o?`${o}.`:""}${e}()`;n=n?Array.isArray(n)||typeof n=="object"&&"any"in n?n:[n]:void 0;function a(h){if(s){const d=s[h];return N(d[0],d[1],$())}return!0}const p=()=>{if(!n)return;const h=`it is unsupported in Mini Apps version ${$()}`;function d(S){return typeof S=="string"?N(S,$())?void 0:h:S.fn()?void 0:S.error}if(Array.isArray(n)){for(const S of n){const Tt=d(S);if(Tt)return Tt}return}let V;for(const S of n.any)if(V=d(S),!V)return;return h},c=(...h)=>{if(s){for(const d in s)if(s[d][2](...h)&&!a(d))return`option ${d} is not supported in Mini Apps version ${$()}`}},f=w(()=>!p()),b=w(()=>$()!=="0.0"),m=w(()=>!r||r()),T=w(()=>Dt("simple")&&!Bt()&&b()&&f()&&m());let v;if(s){v={};for(const h in s)v[h]=w(()=>a(h))}return Object.assign((...h)=>{const d=`Unable to call the ${i} ${o?"method":"function"}:`;if(Bt()||!Dt("simple"))throw new l(fn,`${d} it can't be called outside Mini Apps`);if(!b())throw new l(fo,`${d} the SDK was not initialized. Use the SDK init() function`);const V=p();if(V)throw new l(Mt,`${d} ${V}`);const S=c(...h);if(S)throw new l(Mt,`${d} ${S}`);if(!m())throw new l(_o,`${d} the component is not mounted. Use the ${o}.mount() method`);return t(...h)},t,{isAvailable:T,ifAvailable(...h){return T()?t(...h):void 0}},n?{isSupported:f}:{},v?{supports:v}:{})}function Ee(e,t){return t||(t={}),(n,r,o,s)=>gn(n,r,{...t,isSupported:o||t.isSupported,supports:s,component:e})}function J(e,t,n){return Ee(e,{isSupported:n,isMounted:t})}function k(e,t){return Ee(e,{isSupported:t})}const Se="web_app_setup_back_button",wn="back_button_pressed",Ae="backButton",Fe=u(!1),ne=u(!1),ho=at(Se),yn=J(Ae,ne,Se),pt=k(Ae,Se),bo=yn("hide",()=>{lt(!1)}),mo=pt("mount",()=>{ne()||(lt(x()&&R(Ae)||!1),ne.set(!0))});function lt(e){e!==Fe()&&(_(Se,{is_visible:e}),C(Ae,e),Fe.set(e))}const go=pt("onClick",e=>E(wn,e)),wo=pt("offClick",e=>{ye(wn,e)}),yo=yn("show",()=>{lt(!0)});function vo(){ne.set(!1)}const de=Object.freeze(Object.defineProperty({__proto__:null,hide:bo,isMounted:ne,isSupported:ho,isVisible:Fe,mount:mo,offClick:wo,onClick:go,show:yo,unmount:vo},Symbol.toStringTag,{value:"Module"}));function vn(e,t,n,{isMounting:r,isMounted:o,mountError:s}){return i=>y.withFn(async a=>{if(o())return;if(r())throw new l(uo,`The ${e} component is already mounting`);r.set(!0);let p;try{p=[!0,await t({abortSignal:a})]}catch(c){p=[!1,c]}ro(()=>{if(r.set(!1),o.set(!0),p[0])n(p[1]);else{const c=p[1];throw s.set(c),c}})},i)}const I=Ee,En=u(),Le=u(!1),Me=u(!1),Sn=u(!1),Eo=u(!1),So=u(void 0);function ft(e){return e.available?{available:!0,tokenSaved:e.token_saved,deviceId:e.device_id,accessRequested:e.access_requested,type:e.type,accessGranted:e.access_granted}:{available:!1}}const Ut="web_app_biometry_get_info",Ao=gn("requestBiometry",e=>D(Ut,"biometry_info_received",e).then(ft),{isSupported:Ut}),_t="web_app_biometry_request_auth",Co="web_app_biometry_request_access",Ro="web_app_biometry_open_settings",ko="web_app_biometry_update_token",An="biometry_info_received",q="biometry",Oo=I(q),Po=k(q,_t),dt=J(q,Sn,_t);function Cn(){throw new l(lo,"Biometry is not available")}dt("authenticate",e=>y.withFn(async t=>{if(Le())throw new l(mn,"Authentication is already in progress");const n=En();(!n||!n.available)&&Cn(),Le.set(!0);try{const r=await D(_t,"biometry_auth_requested",{abortSignal:t,params:{reason:((e||{}).reason||"").trim()}}),{token:o}=r;return typeof o=="string"&&Ce({...n,token:o}),r}finally{Le.set(!1)}},e));Po("openSettings",()=>{_(Ro)});dt("requestAccess",e=>y.withFn(async t=>{if(Me())throw new l(mn,"Access request is already in progress");Me.set(!0);try{const n=await D(Co,An,{abortSignal:t,params:{reason:(e||{}).reason||""}}).then(ft);return n.available||Cn(),Ce(n),n.accessGranted}finally{Me.set(!1)}},e));Oo("mount",vn(q,e=>x()&&R(q)||Ao(e),e=>{E(An,xo),Ce(e)},{isMounted:Sn,mountError:So,isMounting:Eo}));const xo=e=>{Ce(ft(e))};function Ce(e){En.set(e),C(q,e)}dt("updateToken",e=>(e||(e={}),D(ko,"biometry_token_updated",{...e,params:{token:e.token||"",reason:e.reason}}).then(t=>t.status)));function Re(e,t){return Ee(e,{isMounted:t})}const ke="closingBehavior",qt=u(!1),Ge=u(!1),Rn=Re(ke,Ge),To=I(ke);Rn("disableConfirmation",()=>{ht(!1)});Rn("enableConfirmation",()=>{ht(!0)});To("mount",()=>{Ge()||(ht(x()&&R(ke)||!1),Ge.set(!0))});function ht(e){e!==qt()&&(_("web_app_setup_closing_behavior",{need_confirmation:e}),C(ke,e),qt.set(e))}const kn="web_app_invoke_custom_method",Oe=k("cloudStorage",kn),$o=at(kn),Io=Oe("deleteItem",(e,t)=>{const n=Array.isArray(e)?e:[e];return n.length?ve("deleteStorageValues",{keys:n},t).then():y.resolve()});function Vo(e,t){const n=Array.isArray(e)?e:[e];return n.length?ve("getStorageValues",{keys:n},t).then(r=>{const o=nr(Object.fromEntries(n.map(s=>[s,tt()])))()(r);return Array.isArray(e)?o:o[e]}):y.resolve(typeof e=="string"?"":{})}const jo=Oe("getItem",Vo),No=Oe("getKeys",e=>ve("getStorageKeys",{},e).then(ir(tt())())),Do=Oe("setItem",(e,t,n)=>ve("saveStorageValue",{key:e,value:t},n).then()),he=Object.freeze(Object.defineProperty({__proto__:null,deleteItem:Io,getItem:jo,getKeys:No,isSupported:$o,setItem:Do},Symbol.toStringTag,{value:"Module"})),le="web_app_trigger_haptic_feedback",bt=k("hapticFeedback",le),Lo=at(le),Mo=bt("impactOccurred",e=>{_(le,{type:"impact",impact_style:e})}),On=bt("notificationOccurred",e=>{_(le,{type:"notification",notification_type:e})}),Bo=bt("selectionChanged",()=>{_(le,{type:"selection_change"})}),Uo=Object.freeze(Object.defineProperty({__proto__:null,impactOccurred:Mo,isSupported:Lo,notificationOccurred:On,selectionChanged:Bo},Symbol.toStringTag,{value:"Module"})),Pn="web_app_open_invoice",qo=k("invoice",Pn),Be=u(!1);async function Wo(e,t,n){if(Be())throw new l(ut,"An invoice is already opened");let r;if(t==="url"){const{hostname:o,pathname:s}=new URL(e,window.location.href);if(o!=="t.me")throw new l(ct,`Link has unexpected hostname: ${o}`);const i=s.match(/^\/(\$|invoice\/)([A-Za-z0-9\-_=]+)$/);if(!i)throw new l(co,'Expected to receive a link with a pathname in format "/invoice/{slug}" or "/${slug}"');[,,r]=i}else r=e,n=t;return Be.set(!0),D(Pn,"invoice_closed",{...n,params:{slug:r},capture:o=>r===o.slug}).then(o=>o.status).finally(()=>{Be.set(!1)})}qo("open",Wo);function Ho(e){const t=Zt(e);return Math.sqrt([.299,.587,.114].reduce((n,r,o)=>{const s=parseInt(t.slice(1+o*2,1+(o+1)*2),16);return n+s*s*r},0))<120}const ze=u(!1),Ue=u(!1),U=u({});function fe(e){return w(()=>U()[e])}const xn=fe("bgColor"),Tn=fe("buttonColor"),Jo=fe("buttonTextColor"),Fo=fe("bottomBarBgColor"),Ke=fe("secondaryBgColor");function L(e){return w(()=>mt()[e])}const Y=u({hasShineEffect:!1,isEnabled:!0,isLoaderVisible:!1,isVisible:!1,text:"Continue"}),mt=w(()=>{const e=Y();return{...e,backgroundColor:e.backgroundColor||Tn()||"#2481cc",textColor:e.textColor||Jo()||"#ffffff"}}),re=u(!1),Go=L("backgroundColor"),zo=L("hasShineEffect"),Ko=L("isEnabled"),Yo=L("isLoaderVisible"),Zo=L("isVisible"),Xo=L("text"),Qo=L("textColor"),es="web_app_setup_main_button",$n="main_button_pressed",Pe="mainButton",gt=I(Pe),ts=Re(Pe,re),ns=gt("mount",()=>{if(!re()){const e=x()&&R(Pe);e&&Y.set(e),re.set(!0)}}),rs=gt("onClick",e=>E($n,e)),os=gt("offClick",e=>{ye($n,e)}),ss=ts("setParams",e=>{Y.set({...Y(),...Object.fromEntries(Object.entries(e).filter(([,n])=>n!==void 0))}),C(Pe,Y());const t=mt();t.text&&_(es,{color:t.backgroundColor,has_shine_effect:t.hasShineEffect,is_active:t.isEnabled,is_progress_visible:t.isLoaderVisible,is_visible:t.isVisible,text:t.text,text_color:t.textColor})});function is(){re.set(!1)}const M=Object.freeze(Object.defineProperty({__proto__:null,backgroundColor:Go,hasShineEffect:zo,isEnabled:Ko,isLoaderVisible:Yo,isMounted:re,isVisible:Zo,mount:ns,offClick:os,onClick:rs,setParams:ss,state:mt,text:Xo,textColor:Qo,unmount:is},Symbol.toStringTag,{value:"Module"}));function wt(){throw new l(po,"CSS variables are already bound")}function as(e){return sr()(e)}const xe="themeParams",cs="theme_changed",us=I(xe),ps=Re(xe,ze);ps("bindCssVars",e=>{Ue()&&wt(),e||(e=r=>`--tg-theme-${nt(r)}`);function t(r){Object.entries(U()).forEach(([o,s])=>{s&&r(o,s)})}function n(){t((r,o)=>{rt(e(r),o)})}return n(),U.sub(n),Ue.set(!0),()=>{t(ot),U.unsub(n),Ue.set(!1)}});const ls=us("mount",()=>{ze()||(E(cs,fs),U.set(x()&&R(xe)||pe().themeParams),ze.set(!0))}),fs=e=>{const t=as(e.theme_params);U.set(t),C(xe,t)};function In(e){return w(()=>{const t=e();return Q(t)?t:t==="bg_color"?xn():Ke()})}const oe=u("bg_color"),yt=In(oe),se=u("bottom_bar_bg_color"),vt=w(()=>{const e=se();return Q(e)?e:e==="bottom_bar_bg_color"?Fo()||Ke():e==="secondary_bg_color"?Ke():xn()}),ie=u("bg_color"),Vn=In(ie),ae=u(!1),be=u(!1),_s=w(()=>{const e=yt();return e?Ho(e):!1}),jn=w(()=>({backgroundColor:oe(),bottomBarColor:se(),headerColor:ie()})),Ye="web_app_set_background_color",Ze="web_app_set_bottom_bar_color",me="web_app_set_header_color",_e="miniApp",Et={any:[Ye,Ze,me]},ds=w(()=>Et.any.some(e=>N(e,$()))),Nn=I(_e),hs=k(_e,Et),Te=J(_e,ae,Et),bs=Te("bindCssVars",e=>{be()&&wt();const[t,n]=W();function r(o,s){function i(){rt(o,s()||null)}i(),t(s.sub(i),ot.bind(null,o))}return e||(e=o=>`--tg-${nt(o)}`),r(e("bgColor"),yt),r(e("bottomBarColor"),vt),r(e("headerColor"),Vn),t(()=>{be.set(!1)}),be.set(!0),n}),Dn=Nn("close",e=>{_("web_app_close",{return_back:e})}),ms=hs("mount",()=>{if(!ae()){const e=x()&&R(_e);ls(),Ln.ifAvailable(e?e.backgroundColor:"bg_color"),Mn.ifAvailable(e?e.bottomBarColor:"bottom_bar_bg_color"),Bn.ifAvailable(e?e.headerColor:"bg_color"),ae.set(!0)}}),gs=Nn("ready",()=>{_("web_app_ready")});function St(){C(_e,jn())}const Ln=Te("setBackgroundColor",e=>{e!==oe()&&(_(Ye,{color:e}),oe.set(e),St())},Ye),Mn=Te("setBottomBarColor",e=>{e!==se()&&(_(Ze,{color:e}),se.set(e),St())},Ze),Bn=Te("setHeaderColor",e=>{e!==ie()&&(_(me,Q(e)?{color:e}:{color_key:e}),ie.set(e),St())},me,{rgb:[me,"color",Q]});function ws(){ae.set(!1)}const ys=Object.freeze(Object.defineProperty({__proto__:null,backgroundColor:oe,backgroundColorRGB:yt,bindCssVars:bs,bottomBarColor:se,bottomBarColorRGB:vt,close:Dn,headerColor:ie,headerColorRGB:Vn,isCssVarsBound:be,isDark:_s,isMounted:ae,isSupported:ds,mount:ms,ready:gs,setBackgroundColor:Ln,setBottomBarColor:Mn,setHeaderColor:Bn,state:jn,unmount:ws},Symbol.toStringTag,{value:"Module"}));function vs(e){const t=e.message.trim(),n=(e.title||"").trim(),r=e.buttons||[];if(n.length>64)throw new l(F,`Invalid title: ${n}`);if(!t||t.length>256)throw new l(F,`Invalid message: ${t}`);if(r.length>3)throw new l(F,`Invalid buttons count: ${r.length}`);return{title:n,message:t,buttons:r.length?r.map((o,s)=>{const i=o.id||"";if(i.length>64)throw new l(F,`Button with index ${s} has invalid id: ${i}`);if(!o.type||o.type==="default"||o.type==="destructive"){const a=o.text.trim();if(!a||a.length>64)throw new l(F,`Button with index ${s} has invalid text: ${a}`);return{type:o.type,text:a,id:i}}return{type:o.type,id:i}}):[{type:"close",id:""}]}}const Un="web_app_open_popup",Es=k("popup",Un),qe=u(!1);Es("open",async e=>{if(qe())throw new l(ut,"A popup is already opened");qe.set(!0);try{const{button_id:t=null}=await D(Un,"popup_closed",{...e,params:vs(e)});return t}finally{qe.set(!1)}});const Ss="web_app_close_scan_qr_popup",qn="web_app_open_scan_qr_popup",As="scan_qr_popup_closed",Cs="qr_text_received",Wn=k("qrScanner",qn),Wt=Wn("close",()=>{G.set(!1),_(Ss)}),G=u(!1);function Rs(e){return y.withFn(t=>{if(G())throw new l(ut,"The QR Scanner is already opened");G.set(!0),e||(e={});const{onCaptured:n,text:r,capture:o}=e,[,s]=W(G.sub(()=>{i.resolve()}),E(As,()=>{G.set(!1)}),E(Cs,a=>{n?n(a.data):(!o||o(a.data))&&(i.resolve(a.data),Wt())})),i=new z({abortSignal:t}).catch(Wt).finally(s);return(e.postEvent||_)(qn,{text:r}),i},e)}Wn("open",Rs);const Z=u({hasShineEffect:!1,isEnabled:!0,isLoaderVisible:!1,isVisible:!1,position:"left",text:"Cancel"}),ks=w(()=>{const e=Z();return{...e,backgroundColor:e.backgroundColor||vt()||"#000000",textColor:e.textColor||Tn()||"#2481cc"}}),Xe=u(!1),At="web_app_setup_secondary_button",Hn="secondary_button_pressed",$e="secondaryButton",Ct=k($e,At),Os=J($e,Xe,At);Ct("mount",()=>{if(!Xe()){const e=x()&&R($e);e&&Z.set(e),Xe.set(!0)}});Ct("onClick",e=>E(Hn,e));Ct("offClick",e=>{ye(Hn,e)});Os("setParams",e=>{Z.set({...Z(),...Object.fromEntries(Object.entries(e).filter(([,n])=>n!==void 0))}),C($e,Z());const t=ks();t.text&&_(At,{color:t.backgroundColor,has_shine_effect:t.hasShineEffect,is_active:t.isEnabled,is_progress_visible:t.isLoaderVisible,is_visible:t.isVisible,position:t.position,text:t.text,text_color:t.textColor})});const Rt="web_app_setup_settings_button",Jn="settings_button_pressed",Ie="settingsButton",Ht=u(!1),Qe=u(!1),kt=k(Ie,Rt),Fn=J(Ie,Qe,Rt);Fn("hide",()=>{Ot(!1)});kt("mount",()=>{Qe()||(Ot(x()&&R(Ie)||!1),Qe.set(!0))});function Ot(e){e!==Ht()&&(_(Rt,{is_visible:e}),C(Ie,e),Ht.set(e))}kt("onClick",e=>E(Jn,e));kt("offClick",e=>{ye(Jn,e)});Fn("show",()=>{Ot(!0)});const Pt="web_app_setup_swipe_behavior",Ve="swipeBehavior",et=u(!1),Jt=u(!0),Ps=k(Ve,Pt),Gn=J(Ve,et,Pt);Gn("disableVertical",()=>{xt(!1)});Gn("enableVertical",()=>{xt(!0)});Ps("mount",()=>{et()||(xt(x()&&R(Ve)||!1,!0),et.set(!0))});function xt(e,t){(e!==Jt()||t)&&(_(Pt,{allow_vertical_swipe:e}),C(Ve,e),Jt.set(e))}const j=u({height:0,width:0,isExpanded:!1,stableHeight:0}),zn=u(!1),We=u(!1),xs=u(!1),Ts=u(void 0);function $s(e){return D("web_app_request_viewport","viewport_changed",e).then(t=>({height:t.height,width:t.width,isExpanded:t.is_expanded,isStable:t.is_state_stable}))}const we="viewport",Kn=I(we),Is=Re(we,zn);Is("bindCssVars",e=>{We()&&wt(),e||(e=r=>`--tg-viewport-${nt(r)}`);const t=["height","width","stableHeight"];function n(){t.forEach(r=>{rt(e(r),`${j()[r]}px`)})}return n(),j.sub(n),We.set(!0),()=>{t.forEach(ot),j.unsub(n),We.set(!1)}});Kn("expand",()=>{_("web_app_expand")});Kn("mount",vn(we,e=>{const t=x()&&R(we);if(t)return t;if(["macos","tdesktop","unigram","webk","weba","web"].includes(pe().platform)){const n=window;return{isExpanded:!0,height:n.innerHeight,width:n.innerWidth,stableHeight:n.innerHeight}}return e.timeout||(e.timeout=1e3),$s(e).then(n=>({height:n.height,isExpanded:n.isExpanded,stableHeight:n.isStable?n.height:j().stableHeight,width:n.width}))},e=>{E("viewport_changed",Vs),Yn(e)},{isMounted:zn,isMounting:xs,mountError:Ts}));const Vs=e=>{Yn({height:e.height,isExpanded:e.is_expanded,stableHeight:e.is_state_stable?e.height:j().stableHeight,width:e.width})};function Yn(e){j.set({isExpanded:e.isExpanded,height:He(e.height),width:He(e.width),stableHeight:He(e.stableHeight)}),C("viewport",j())}function He(e){return Math.max(e,0)}const js=I();js("openLink",(e,t)=>{if(typeof e=="string")try{e=new URL(e)}catch(n){throw new l(ct,`"${e.toString()}" is invalid URL`,n)}t||(t={}),_("web_app_open_link",{url:e.toString(),try_browser:t.tryBrowser,try_instant_view:t.tryInstantView})});const Ft="web_app_open_tg_link",Ns=I(),Ds=Ns("openTelegramLink",e=>{const t=e.toString();if(!t.match(/^https:\/\/t.me\/.+/))throw new l(ct,`"${t}" is invalid URL`);if(!N(Ft,$())){window.location.href=t;return}e=new URL(e),_(Ft,{path_full:e.pathname+e.search})}),Ls=I();Ls("shareURL",(e,t)=>{Ds("https://t.me/share/url?"+new URLSearchParams({url:e,text:t||""}).toString().replace(/\+/g,"%20"))});function Ms(e){io(e),Kr();const[t,n]=W(E("reload_iframe",()=>{_("iframe_will_reload"),window.location.reload()}),Yr),{acceptCustomStyles:r=!0}={};if(r){const o=document.createElement("style");o.id="telegram-custom-styles",document.head.appendChild(o),t(E("set_custom_style",s=>{o.innerHTML=s}),()=>{document.head.removeChild(o)})}return _("iframe_ready",{reload_supported:!0}),n}class Bs{closeWith(t){On(t),ys.close.isAvailable()&&Dn()}getInitData(){const{initData:t}=pe();if(t===void 0)throw"Could not retrieve Telegram Launch Parameters";return t}init(t){Ms(),de.mount(),M.mount(),t==="/"?de.hide():de.show(),de.onClick(()=>window.history.back())}setMainButtonText(t){M.setParams({text:t})}onMainButtonClick(t){M.onClick(t)}showMainButton(t){this.setMainButtonText(t),M.setParams({isVisible:!0})}offMainButtonClick(t){M.offClick(t)}hideMainButton(){M.setParams({isVisible:!1})}envokeHaptic(t){Uo.impactOccurred(t)}async addToStorage(t,n){try{return await he.setItem(t,n)}catch(r){alert(r)}}async getKeys(){return await he.getKeys()}async getItem(t){return await he.getItem(t)}async deleteItem(t){return await he.deleteItem(t)}async findInArrayItem(t,n,r){let o=await this.getItem(t),s=[];return o.length&&(s=JSON.parse(o)),s.find(i=>i[r]===n)}async removeFromArrayItem(t,n,r){let o=await this.getItem(t),s=[];o.length&&(s=JSON.parse(o));let i=[];return i=s.filter(a=>a[r]!==n),this.addToStorage(t,JSON.stringify(i)),i}async addToArrayItem(t,n){let r=await this.getItem(t),o=[];r.length&&(o=JSON.parse(r));let s=[];return s=o.concat(n),this.addToStorage(t,JSON.stringify(s)),s}}const Us=new Bs;export{Us as t};
